<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Kalkulator Ciep≈Ça ‚Äì Tryb Standalone</title>

    <!-- STYLE -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="dns-prefetch" href="https://topinstal.com.pl" />
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css"
    />
    <link rel="stylesheet" href="./css/main.css" />
    <link rel="stylesheet" href="./css/error-system.css" />
    <link rel="stylesheet" href="./css/onboarding-modal.css" />
    <link rel="stylesheet" href="./css/workflow-system.css" />
    <link rel="stylesheet" href="./css/ai-coach-dock.css" />

    <!-- üÜï MOBILE REDESIGN CSS -->
    <link rel="stylesheet" href="./css/mobile-redesign.css" />
  </head>

  <body>
    <!-- PodglƒÖdowy sticky header -->
    <div class="top-preview-header">
      <img src="../img/headerek.png" alt="TOP-INSTAL ‚Äì nag≈Ç√≥wek podglƒÖdowy" />
    </div>

    <!-- Konfiguracja standalone (zastƒôpuje wp_localize_script) -->
    <script>
      window.topinstal_config = {
        ajax_url: '#',
        plugin_url: './',
        nonce: 'dev-local',
      };
    </script>

    <!-- Option Cards JavaScript -->
    <script>
      (function () {
        function initOptionCards() {
          const optionCards = document.querySelectorAll('.option-card');
          if (optionCards.length === 0) {
            setTimeout(initOptionCards, 100);
            return;
          }

          const cardsByField = {};
          optionCards.forEach(card => {
            const fieldName = card.dataset.field;
            if (!fieldName) return;
            if (!cardsByField[fieldName]) {
              cardsByField[fieldName] = [];
            }
            cardsByField[fieldName].push(card);
          });

          Object.keys(cardsByField).forEach(fieldName => {
            const cards = cardsByField[fieldName];
            const hiddenInput = document.getElementById(fieldName);
            if (!hiddenInput) {
              console.warn(`Nie znaleziono ukrytego inputa dla ${fieldName}`);
              return;
            }

            const updateCardsFromInput = () => {
              const value = hiddenInput.value;
              cards.forEach(card => {
                if (card.dataset.value === value) {
                  card.classList.add('option-card--selected');
                } else {
                  card.classList.remove('option-card--selected');
                }
              });
            };

            const triggerOptionChange = value => {
              hiddenInput.value = value;
              updateCardsFromInput();

              // formEngine automatycznie zareaguje na te eventy
              const changeEvent = new Event('change', { bubbles: true, cancelable: true });
              hiddenInput.dispatchEvent(changeEvent);

              const inputEvent = new Event('input', { bubbles: true, cancelable: true });
              hiddenInput.dispatchEvent(inputEvent);
            };

            cards.forEach(card => {
              card.addEventListener('click', function () {
                const value = this.dataset.value;
                if (!value || this.classList.contains('option-card--disabled')) return;
                triggerOptionChange(value);
              });

              card.addEventListener('keydown', function (e) {
                if (e.key === 'Enter' || e.key === ' ') {
                  e.preventDefault();
                  const value = this.dataset.value;
                  if (!value || this.classList.contains('option-card--disabled')) return;
                  triggerOptionChange(value);
                }
              });
            });

            hiddenInput.addEventListener('change', updateCardsFromInput);
            updateCardsFromInput();
          });
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initOptionCards);
        } else {
          setTimeout(initOptionCards, 100);
        }

        window.addEventListener('load', function () {
          setTimeout(initOptionCards, 200);
        });
      })();
    </script>

    <!-- HERO BANNER -->
    <section class="hero hero-hetzner" aria-label="Top-Instal - konfigurator">
      <!-- Obraz banera -->
      <div class="hero-media">
        <img src="../img/header-image.png" alt="Panasonic" loading="eager" />
      </div>

      <!-- Tre≈õƒá -->
      <div class="container hero-inner">
        <span class="hero-pill">TOP-INSTAL</span>
        <h1>KALKULATOR MOCY POMPY CIEP≈ÅA</h1>
        <p class="hero-lead">
          Dob√≥r mocy pompy ciep≈Ça jest kluczowy dla jej efektywnej pracy. Nowoczesne pompy
          automatycznie dostosowujƒÖ wydajno≈õƒá do warunk√≥w zewnƒôtrznych, obni≈ºajƒÖc moc nawet do 20%.
          Zbyt du≈ºa jednostka powoduje taktowanie, skraca ≈ºywotno≈õƒá i zwiƒôksza rachunki. Aby
          urzƒÖdzenie dzia≈Ça≈Ço ekonomicznie, moc musi byƒá dobrana precyzyjnie. Kalkulator
          wykorzystuje dane, kt√≥re podasz ‚Äî wprowad≈∫ je zgodnie z rzeczywisto≈õciƒÖ.
        </p>
      </div>
    </section>

    <div id="top-instal-calc" class="wrapper">
      <!-- Progress Bar Container (wsp√≥lny dla wszystkich zak≈Çadek) -->
      <div class="progress-bar-container" id="progress-bar-container">
        <div class="form-progress hp-progress" id="global-progress-bar">
          <div class="form-progress-fill" id="top-progress-fill" style="width: 12%"></div>
        </div>
        <div class="progress-info-row hp-progress-info" id="global-progress-info">
          <div class="form-progress-percentage" id="progress-percentage">12%</div>
          <div class="form-progress-label" id="progress-label">Start ¬∑ Wprowadzenie</div>
        </div>
      </div>
      <div class="progress-sticky-placeholder" id="progress-placeholder"></div>

      <!-- Formularz -->
      <form id="heatCalcFormFull" novalidate>
        <div class="section active" data-tab="0">
          <!-- Instrukcja + Dane -->
          <div class="formularz-z-mapa">
            <div class="formularz">
              <h3>INFORMACJE O BUDYNKU:</h3>
              <!-- Typ budynku -->
              <div class="form-row-mosaic form-card">
                <div class="form-field">
                  <div class="form-field-item">
                    <label for="building_type" class="form-label">Jaki to rodzaj budynku?</label>
                    <input
                      type="hidden"
                      id="building_type"
                      name="building_type"
                      value=""
                      required
                    />
                    <!-- Karty z ikonami - przechowujƒÖ warto≈õƒá building_type -->
                    <div class="building-type-cards">
                      <button
                        type="button"
                        class="building-type-card building-type-card--first"
                        data-value="single_house"
                        aria-label="Dom wolnostojƒÖcy"
                        tabindex="0"
                      >
                        <div class="building-type-card__icon">
                          <img src="../img/dom.png" alt="Dom wolnostojƒÖcy" width="80" height="80" />
                        </div>
                        <div class="building-type-card__label">Dom<br />wolnostojƒÖcy</div>
                      </button>
                      <button
                        type="button"
                        class="building-type-card"
                        data-value="double_house"
                        aria-label="Bli≈∫niak"
                        tabindex="0"
                      >
                        <div class="building-type-card__icon">
                          <img src="../img/blizniak.png" alt="Bli≈∫niak" width="80" height="80" />
                        </div>
                        <div class="building-type-card__label">Bli≈∫niak</div>
                      </button>
                      <button
                        type="button"
                        class="building-type-card"
                        data-value="row_house"
                        aria-label="Szeregowiec"
                        tabindex="0"
                      >
                        <div class="building-type-card__icon">
                          <img
                            src="../img/szeregowiec.png"
                            alt="Szeregowiec"
                            width="80"
                            height="80"
                          />
                        </div>
                        <div class="building-type-card__label">Szeregowiec</div>
                      </button>
                      <button
                        type="button"
                        class="building-type-card"
                        data-value="apartment"
                        aria-label="Mieszkanie"
                        tabindex="0"
                      >
                        <div class="building-type-card__icon">
                          <img
                            src="../img/mieszkanie.png"
                            alt="Mieszkanie"
                            width="80"
                            height="80"
                          />
                        </div>
                        <div class="building-type-card__label">Mieszkanie</div>
                      </button>
                    </div>
                  </div>

                  <div class="form-field-item form-field-item--subsequent">
                    <label for="construction_year" class="form-label">Rok budowy budynku</label>
                    <div class="construction-year-wrapper">
                      <select
                        id="construction_year"
                        name="construction_year"
                        required
                        class="form-select"
                        aria-describedby="construction-year-help"
                      >
                        <option value="">-- Wybierz --</option>
                        <option value="2025">2025 (nowy / w budowie)</option>
                        <option value="2021">2021‚Äì2024</option>
                        <option value="2011">2011‚Äì2020</option>
                        <option value="2000">2000‚Äì2010</option>
                        <option value="1990">1991‚Äì2000</option>
                        <option value="1980">1981‚Äì1990</option>
                        <option value="1970">1971‚Äì1980</option>
                        <option value="1960">1961‚Äì1970</option>
                        <option value="1950">1950‚Äì1960</option>
                        <option value="1940">1940‚Äì1949</option>
                        <option value="1939">przed 1939 (przed II wojnƒÖ)</option>
                      </select>
                    </div>
                  </div>
                </div>

                <!-- Help box -->
                <div class="help-box help-box--tip" id="building-type-help">
                  <h4><i class="ph ph-info"></i>Jak to dzia≈Ça?</h4>
                  <p>
                    W kilka minut poznasz zapotrzebowanie budynku na ciep≈Ço i odpowiedniƒÖ moc pompy.
                  </p>
                  <p>
                    Wype≈Çnij formularz krok po kroku ‚Äì dok≈Çadniejsze dane to dok≈Çadniejszy wynik.
                  </p>
                  <p>Na ko≈Ñcu pobierzesz gotowy raport PDF z wynikami i rekomendacjami.</p>
                  <p><strong>Korzystasz swobodnie - bez rejestracji.</strong></p>
                </div>
              </div>

              <!-- Pola specjalne dla SZEREGOWCA (row_house) -->
              <div id="rowHouseFields" class="hidden" style="display: none">
                <h3>OTOCZENIE SZEREGOWCA:</h3>
                <div class="form-row-mosaic form-card">
                  <div class="form-field">
                    <div class="form-field-item">
                      <label class="form-label"
                        >Czy Twoje mieszkanie jest segmentem naro≈ºnym?</label
                      >
                      <p class="micro-note" style="margin: 4px 0 16px">
                        Segment naro≈ºny ma wiƒôcej przegr√≥d zewnƒôtrznych, co wp≈Çywa na straty ciep≈Ça.
                      </p>
                      <input type="hidden" id="on_corner" name="on_corner" value="" />
                      <div class="yes-no-cards">
                        <button
                          type="button"
                          class="yes-no-card"
                          data-field="on_corner"
                          data-value="yes"
                          aria-label="Tak, segment naro≈ºny"
                          tabindex="0"
                        >
                          <span class="yes-no-card__label">Tak</span>
                        </button>
                        <button
                          type="button"
                          class="yes-no-card"
                          data-field="on_corner"
                          data-value="no"
                          aria-label="Nie, segment ≈õrodkowy"
                          tabindex="0"
                        >
                          <span class="yes-no-card__label">Nie</span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="help-box help-box--tip">
                    <h4><i class="ph ph-lightbulb"></i> Dlaczego to pytanie?</h4>
                    <p>
                      Segment naro≈ºny ma dodatkowe ≈õciany zewnƒôtrzne oraz wiƒôkszƒÖ powierzchniƒô
                      dachu. To zwiƒôksza zapotrzebowanie na moc pompy ciep≈Ça, dlatego musimy
                      uwzglƒôdniƒá ten parametr.
                    </p>
                  </div>
                </div>
              </div>

              <!-- Pola specjalne dla MIESZKANIA (apartment) -->
              <div id="apartmentFields" class="hidden" style="display: none">
                <h3>OTOCZENIE MIESZKANIA</h3>
                <div class="form-row-mosaic form-card">
                  <div class="help-box help-box--tip help-box--full-width">
                    <h4><i class="ph ph-lightbulb"></i> Okre≈õlanie otoczenia mieszkania</h4>
                    <p>
                      Dla mieszka≈Ñ musimy wiedzieƒá, co znajduje siƒô wok√≥≈Ç mieszkania, aby prawid≈Çowo
                      obliczyƒá straty ciep≈Ça przez przegrody.
                    </p>
                    <p>
                      <strong>Ogrzewany lokal</strong> - inne mieszkanie lub pomieszczenie ogrzewane
                    </p>
                    <p>
                      <strong>Nieogrzewany lokal</strong> - korytarz, klatka schodowa, piwnica
                      nieogrzewana
                    </p>
                    <p><strong>≈öwiat zewnƒôtrzny</strong> - ≈õciana zewnƒôtrzna budynku, dach</p>
                  </div>

                  <div class="form-field">
                    <label for="whats_over" class="form-label"
                      >Co znajduje siƒô powy≈ºej mieszkania?</label
                    >
                    <select id="whats_over" name="whats_over" class="form-select">
                      <option value="">-- Wybierz --</option>
                      <option value="heated_room">Ogrzewany lokal</option>
                      <option value="unheated_room">Nieogrzewany lokal / korytarz / klatka</option>
                      <option value="outdoor">≈öwiat zewnƒôtrzny / dach</option>
                      <option value="ground">Grunt / pod≈Çoga na gruncie</option>
                    </select>
                  </div>

                  <div class="form-field">
                    <label for="whats_under" class="form-label"
                      >Co znajduje siƒô poni≈ºej mieszkania?</label
                    >
                    <select id="whats_under" name="whats_under" class="form-select">
                      <option value="">-- Wybierz --</option>
                      <option value="heated_room">Ogrzewany lokal</option>
                      <option value="unheated_room">Nieogrzewany lokal / korytarz / klatka</option>
                      <option value="outdoor">≈öwiat zewnƒôtrzny</option>
                      <option value="ground">Grunt / pod≈Çoga na gruncie</option>
                    </select>
                  </div>

                  <div class="form-field">
                    <label for="whats_north" class="form-label"
                      >Co znajduje siƒô na p√≥≈Çnoc od mieszkania?</label
                    >
                    <select id="whats_north" name="whats_north" class="form-select">
                      <option value="">-- Wybierz --</option>
                      <option value="heated_room">Ogrzewany lokal</option>
                      <option value="unheated_room">Nieogrzewany lokal / korytarz</option>
                      <option value="outdoor">≈öwiat zewnƒôtrzny (≈õciana zewnƒôtrzna)</option>
                    </select>
                  </div>

                  <div class="form-field">
                    <label for="whats_south" class="form-label"
                      >Co znajduje siƒô na po≈Çudnie od mieszkania?</label
                    >
                    <select id="whats_south" name="whats_south" class="form-select">
                      <option value="">-- Wybierz --</option>
                      <option value="heated_room">Ogrzewany lokal</option>
                      <option value="unheated_room">Nieogrzewany lokal / korytarz</option>
                      <option value="outdoor">≈öwiat zewnƒôtrzny (≈õciana zewnƒôtrzna)</option>
                    </select>
                  </div>

                  <div class="form-field">
                    <label for="whats_east" class="form-label"
                      >Co znajduje siƒô na wsch√≥d od mieszkania?</label
                    >
                    <select id="whats_east" name="whats_east" class="form-select">
                      <option value="">-- Wybierz --</option>
                      <option value="heated_room">Ogrzewany lokal</option>
                      <option value="unheated_room">Nieogrzewany lokal / korytarz</option>
                      <option value="outdoor">≈öwiat zewnƒôtrzny (≈õciana zewnƒôtrzna)</option>
                    </select>
                  </div>

                  <div class="form-field">
                    <label for="whats_west" class="form-label"
                      >Co znajduje siƒô na zach√≥d od mieszkania?</label
                    >
                    <select id="whats_west" name="whats_west" class="form-select">
                      <option value="">-- Wybierz --</option>
                      <option value="heated_room">Ogrzewany lokal</option>
                      <option value="unheated_room">Nieogrzewany lokal / korytarz</option>
                      <option value="outdoor">≈öwiat zewnƒôtrzny (≈õciana zewnƒôtrzna)</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Strefa klimatyczna - Mosaic Layout -->
              <h3>STREFA TEMPERATUROWA:</h3>
              <div class="form-row-mosaic form-card">
                <div class="form-field">
                  <label class="form-label"> Wybierz strefƒô klimatycznƒÖ budynku </label>

                  <div class="form-field__radio-group">
                    <label class="form-field__radio-label">
                      <input type="radio" name="location_id" value="PL_GDANSK" required />
                      <span>Strefa I (-16¬∞C)</span>
                    </label>

                    <label class="form-field__radio-label">
                      <input
                        type="radio"
                        name="location_id"
                        value="PL_KUJAWSKOPOMORSKIE_BYDGOSZCZ"
                        required
                      />
                      <span>Strefa II (-18¬∞C)</span>
                    </label>

                    <label class="form-field__radio-label">
                      <input
                        type="radio"
                        name="location_id"
                        value="PL_DOLNOSLASKIE_WROCLAW"
                        checked
                        required
                      />
                      <span>Strefa III (-20¬∞C)</span>
                    </label>

                    <label class="form-field__radio-label">
                      <input type="radio" name="location_id" value="PL_STREFA_IV" required />
                      <span>Strefa IV (-22¬∞C)</span>
                    </label>

                    <label class="form-field__radio-label">
                      <input type="radio" name="location_id" value="PL_ZAKOPANE" required />
                      <span>Strefa V (-24¬∞C)</span>
                    </label>
                  </div>
                </div>

                <div class="help-box help-box--tip">
                  <h4><i class="ph ph-lightbulb"></i> Strefy klimatyczne</h4>
                  <p>Strefa okre≈õla temperaturƒô projektowƒÖ dla Twojego regionu</p>
                  <img
                    src="../img/mapka.png"
                    alt="Mapa stref klimatycznych w Polsce - oznaczenia temperatur projektowych dla poszczeg√≥lnych region√≥w kraju"
                    class="zone-map"
                    loading="lazy"
                  />
                </div>
              </div>
            </div>
          </div>
          <!-- Przyciski nawigacyjne -->
          <div
            class="btn-row"
            style="display: flex; justify-content: center; width: 100%; grid-column: 1 / -1"
          >
            <button
              id="quick-scenario-trigger"
              type="button"
              class="quick-scenario-btn"
              aria-label="Szybka symulacja na przyk≈Çadowych danych (pomi≈Ñ rƒôczne wype≈Çnianie formularza)"
            >
              ‚ö°
            </button>
            <button class="btn-next1" type="button">‚Üí Dalej ‚Üí</button>
          </div>
        </div>

        <!-- Zak≈Çadka 1: Kszta≈Çt -->
        <div class="section" data-tab="1">
          <h3>WYMIARY BUDYNKU:</h3>
          <div class="form-row-mosaic form-card">
            <div class="form-field">
              <div class="form-field-item">
                <label class="form-label"> Jaki jest obrys budynku? </label>

                <div class="form-field__radio-group">
                  <label class="form-field__radio-label">
                    <input type="radio" name="building_shape" value="regular" required />
                    <span>Regularny (prostokƒÖtny)</span>
                  </label>

                  <label class="form-field__radio-label">
                    <input type="radio" name="building_shape" value="irregular" required />
                    <span>Nieregularny (z wykuszami, wnƒôkami itp.)</span>
                  </label>
                </div>
              </div>

              <div id="regularFields" class="hidden" style="display: none">
                <div class="form-field-item form-field-item--subsequent">
                  <label class="form-label">Wybierz spos√≥b podania wymiar√≥w:</label>
                  <div class="form-field__radio-group">
                    <label class="form-field__radio-label">
                      <input type="radio" name="regular_method" value="dimensions" required />
                      <span>Podam d≈Çugo≈õƒá i szeroko≈õƒá budynku</span>
                    </label>
                    <label class="form-field__radio-label">
                      <input type="radio" name="regular_method" value="area" required />
                      <span>Podam powierzchniƒô zabudowy w m¬≤</span>
                    </label>
                  </div>
                </div>
              </div>

              <div id="dimensionsFields" class="hidden" style="display: none">
                <div class="form-field-item form-field-item--subsequent">
                  <label for="building_length">D≈Çugo≈õƒá</label>
                  <div class="quantity-input-wrapper">
                    <fieldset class="quantity-input" data-quantity="">
                      <legend class="sr-only">Zmie≈Ñ d≈Çugo≈õƒá</legend>
                      <button
                        type="button"
                        title="Zmniejsz"
                        class="quantity-btn quantity-btn--sub"
                        aria-label="Zmniejsz d≈Çugo≈õƒá"
                      >
                        ‚àí
                      </button>
                      <input
                        type="number"
                        id="building_length"
                        name="building_length"
                        step="0.5"
                        min="0"
                        value="10"
                        pattern="[0-9]+"
                      />
                      <button
                        type="button"
                        title="Zwiƒôksz"
                        class="quantity-btn quantity-btn--add"
                        aria-label="Zwiƒôksz d≈Çugo≈õƒá"
                      >
                        +
                      </button>
                    </fieldset>
                    <span class="quantity-unit">m</span>
                  </div>
                </div>
                <div class="form-field-item form-field-item--subsequent">
                  <label for="building_width">Szeroko≈õƒá</label>
                  <div class="quantity-input-wrapper">
                    <fieldset class="quantity-input" data-quantity="">
                      <legend class="sr-only">Zmie≈Ñ szeroko≈õƒá</legend>
                      <button
                        type="button"
                        title="Zmniejsz"
                        class="quantity-btn quantity-btn--sub"
                        aria-label="Zmniejsz szeroko≈õƒá"
                      >
                        ‚àí
                      </button>
                      <input
                        type="number"
                        id="building_width"
                        name="building_width"
                        step="0.5"
                        min="0"
                        value="5"
                        pattern="[0-9]+"
                      />
                      <button
                        type="button"
                        title="Zwiƒôksz"
                        class="quantity-btn quantity-btn--add"
                        aria-label="Zwiƒôksz szeroko≈õƒá"
                      >
                        +
                      </button>
                    </fieldset>
                    <span class="quantity-unit">m</span>
                  </div>
                </div>
              </div>

              <div id="areaField" class="hidden" style="display: none">
                <div class="form-field-item form-field-item--subsequent">
                  <label for="floor_area">Powierzchnia zabudowy (m¬≤)</label>
                  <input id="floor_area" name="floor_area" step="1" type="number" />
                </div>
              </div>

              <div id="irregularFields" class="hidden" style="display: none">
                <div class="form-field-item form-field-item--subsequent">
                  <label for="floor_area_irregular">Powierzchnia zabudowy (m¬≤)</label>
                  <input
                    id="floor_area_irregular"
                    name="floor_area_irregular"
                    step="1"
                    type="number"
                  />
                </div>
                <div class="form-field-item form-field-item--subsequent">
                  <label for="floor_perimeter">Obw√≥d budynku (m)</label>
                  <input id="floor_perimeter" name="floor_perimeter" step="0.5" type="number" />
                </div>
              </div>
            </div>

            <div>
              <div class="help-box help-box--tip">
                <h4><i class="ph ph-lightbulb"></i> Rodzaje obrysu budynku</h4>
                <img
                  src="https://topinstal.com.pl/pictures/obrys.png"
                  alt="Ilustracja przedstawiajƒÖca r√≥≈ºnice miƒôdzy budynkiem regularnym (prostokƒÖtnym) a nieregularnym (z wykuszami i wnƒôkami)"
                  loading="lazy"
                />
              </div>

              <div id="regularAreaHelpBox" class="help-box help-box--tip hidden">
                <h4><i class="ph ph-lightbulb"></i> Co to jest powierzchnia zabudowy?</h4>
                <p>
                  Podajesz kluczowy parametr. Powierzchnia zabudowy to powierzchnia zajmowana przez
                  budynek - okre≈õlamy jƒÖ poprzez zewnƒôtrzne krawƒôdzie ≈õcian i ich rzut na
                  powierzchniƒô gruntu.
                </p>
                <img
                  src="https://topinstal.com.pl/pictures/zabudowa.png"
                  class="obrys-img"
                  alt="Ilustracja powierzchni zabudowy budynku - rzut z g√≥ry pokazujƒÖcy zewnƒôtrzne krawƒôdzie ≈õcian"
                  loading="lazy"
                />
              </div>

              <div id="irregularAreaHelpBox" class="help-box help-box--tip hidden">
                <h4><i class="ph ph-lightbulb"></i> Co to jest powierzchnia zabudowy?</h4>
                <p>
                  Podajesz kluczowy parametr. Powierzchnia zabudowy to powierzchnia zajmowana przez
                  budynek - okre≈õlamy jƒÖ poprzez zewnƒôtrzne krawƒôdzie ≈õcian i ich rzut na
                  powierzchniƒô gruntu.
                </p>
                <img
                  src="https://topinstal.com.pl/pictures/zabudowa.png"
                  class="obrys-img"
                  alt="Ilustracja powierzchni zabudowy budynku - rzut z g√≥ry pokazujƒÖcy zewnƒôtrzne krawƒôdzie ≈õcian"
                  loading="lazy"
                />
              </div>
            </div>
          </div>
          <h3>BRY≈ÅA BUDYNKU:</h3>
          <div class="form-row-mosaic form-card">
            <div class="form-field">
              <div class="form-field-item">
                <label class="form-label">Czy w budynku jest piwnica lub podpiwniczenie?</label>
                <!-- Ukryty input dla kompatybilno≈õci z JavaScript -->
                <input type="hidden" id="has_basement" name="has_basement" value="" />
                <!-- Karty Tak/Nie -->
                <div class="yes-no-cards">
                  <button
                    type="button"
                    class="yes-no-card"
                    data-field="has_basement"
                    data-value="yes"
                    aria-label="Tak"
                    tabindex="0"
                  >
                    <span class="yes-no-card__label">Tak</span>
                  </button>
                  <button
                    type="button"
                    class="yes-no-card"
                    data-field="has_basement"
                    data-value="no"
                    aria-label="Nie"
                    tabindex="0"
                  >
                    <span class="yes-no-card__label">Nie</span>
                  </button>
                </div>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label class="form-label">Czy w budynku sƒÖ balkony?</label>
                <!-- Ukryty input dla kompatybilno≈õci z JavaScript -->
                <input type="hidden" id="has_balcony" name="has_balcony" value="" required />
                <!-- Karty Tak/Nie -->
                <div class="yes-no-cards">
                  <button
                    type="button"
                    class="yes-no-card"
                    data-field="has_balcony"
                    data-value="yes"
                    aria-label="Tak"
                    tabindex="0"
                  >
                    <span class="yes-no-card__label">Tak</span>
                  </button>
                  <button
                    type="button"
                    class="yes-no-card"
                    data-field="has_balcony"
                    data-value="no"
                    aria-label="Nie"
                    tabindex="0"
                  >
                    <span class="yes-no-card__label">Nie</span>
                  </button>
                </div>
              </div>

              <!-- Liczba balkon√≥w - ODDZIELNY kontener -->
              <div class="form-field-item form-field-item--subsequent" id="balconyFields">
                <label class="form-label">Ilo≈õƒá balkon√≥w:</label>

                <div class="custom-slider-container custom-slider-small">
                  <!-- Ukryty input dla formularza -->
                  <input
                    type="hidden"
                    id="number_balcony_doors"
                    name="number_balcony_doors"
                    value="1"
                    data-requires-confirm="true"
                    data-slider-confirmed="false"
                  />

                  <!-- BƒÖbelek z warto≈õciƒÖ -->
                  <div class="custom-bubble" id="customBalconyBubble">1</div>

                  <!-- Track slidera -->
                  <div class="custom-slider-track" id="customSliderTrack">
                    <!-- Thumb (kuleczka) -->
                    <div class="custom-slider-thumb" id="customSliderThumb"></div>
                  </div>

                  <!-- Znaczniki (ticki) -->
                  <div class="custom-slider-ticks">
                    <span class="tick" data-value="1">1</span>
                    <span class="tick" data-value="2">2</span>
                    <span class="tick" data-value="3">3</span>
                    <span class="tick" data-value="4">4</span>
                    <span class="tick" data-value="5">5</span>
                    <span class="tick" data-value="6">6</span>
                  </div>

                  <button
                    type="button"
                    class="building-type-card slider-confirm-card"
                    data-slider-target="number_balcony_doors"
                  >
                    <div class="building-type-card__label">Potwierd≈∫</div>
                    <div class="slider-confirm-card__hint">Przechodzƒô dalej</div>
                  </button>
                </div>
              </div>
            </div>

            <div class="help-box help-box--tip">
              <h4><i class="ph ph-lightbulb"></i> Balkon = mostek cieplny</h4>
              <p>
                Uwzglƒôdniamy tak samo balkony wiszƒÖce, jak w formie wnƒôki (tzw. loggia). Balkon ze
                wzglƒôdu na swojƒÖ konstrukcjƒô stanowi mostek cieplny - mamy tutaj do czynienia z
                utratƒÖ ciep≈Ça.
              </p>
            </div>
          </div>

          <h3>KONDYGNACJE BUDYNKU:</h3>
          <div class="form-row-mosaic form-card">
            <div class="form-field">
              <div class="form-field-item">
                <label for="building_floors">Ile kondygnacji ma budynek? <b>bez poddasza</b></label>
                <select id="building_floors" name="building_floors" required class="form-select">
                  <option value="">-- Wybierz --</option>
                  <option value="1">Parter</option>
                  <option value="2">Parter + 1 piƒôtro</option>
                  <option value="3">Parter + 2 piƒôtra</option>
                  <option value="4">Parter + 3 piƒôtra</option>
                </select>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label class="form-label">Jaki typ dachu ma budynek?</label>
                <input type="hidden" id="building_roof" name="building_roof" value="" required />
                <div class="option-cards">
                  <button
                    type="button"
                    class="option-card"
                    data-field="building_roof"
                    data-value="flat"
                    aria-label="Dach p≈Çaski"
                    tabindex="0"
                  >
                    <span class="option-card__title">P≈Çaski</span>
                    <span class="option-card__subtitle">Dach p≈Çaski</span>
                  </button>
                  <button
                    type="button"
                    class="option-card"
                    data-field="building_roof"
                    data-value="steep"
                    aria-label="Dach sko≈õny z poddaszem"
                    tabindex="0"
                  >
                    <span class="option-card__title">Sko≈õny</span>
                    <span class="option-card__subtitle">Z poddaszem</span>
                  </button>
                  <button
                    type="button"
                    class="option-card"
                    data-field="building_roof"
                    data-value="oblique"
                    aria-label="Dach sko≈õny bez poddasza"
                    tabindex="0"
                  >
                    <span class="option-card__title">Sko≈õny niski</span>
                    <span class="option-card__subtitle">Bez poddasza</span>
                  </button>
                </div>
              </div>

              <div id="heatedFloorsSection" class="form-field-item form-field-item--subsequent">
                <label class="form-label">Kt√≥re kondygnacje sƒÖ ogrzewane?</label>
                <div id="heatedFloorsContainer">
                  <!-- Checkboxy bƒôdƒÖ generowane dynamicznie przez floorRenderer.js -->
                </div>
              </div>

              <!-- Pytanie o dostƒôpno≈õƒá poddasza (dla steep z nieogrzewanym poddaszem) -->
              <div id="atticAccessFields" class="hidden" style="display: none">
                <div class="form-field-item form-field-item--subsequent">
                  <label class="form-label">Jakie warunki panujƒÖ na poddaszu?</label>
                  <div class="form-field__radio-group">
                    <label class="form-field__radio-label">
                      <input type="radio" name="attic_access" value="accessible" required />
                      <span>Jest u≈ºytkowe, z izolacjƒÖ</span>
                    </label>
                    <label class="form-field__radio-label">
                      <input type="radio" name="attic_access" value="inaccessible" required />
                      <span>Kiepsko z izolacjƒÖ - hula tam wiatr</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div>
              <div class="help-box help-box--tip">
                <h4><i class="ph ph-lightbulb"></i> Kt√≥re kondygnacje zaznaczyƒá?</h4>
                <p>
                  Zaznacz tylko te poziomy, kt√≥re sƒÖ realnie ogrzewane - majƒÖ grzejniki lub
                  ogrzewanie pod≈Çogowe.
                </p>
                <p>
                  Nie zaznaczaj zimnych strych√≥w, nieogrzewanych gara≈ºy ani nieu≈ºywanych przestrzeni
                  technicznych.
                </p>
              </div>

              <div class="help-box help-box--tip">
                <h4><i class="ph ph-lightbulb"></i> Dlaczego bez poddasza?</h4>
                <p>
                  Na tym etapie liczy siƒô tylko ile pe≈Çnych, ogrzewanych piƒôter ma budynek. Poddasze
                  zostanie uwzglƒôdnione osobno w kolejnym kroku.
                </p>
                <p>
                  <strong>Przyk≈Çad:</strong> Parter + piƒôtro + poddasze u≈ºytkowe ‚Üí wybierz "Parter +
                  1 piƒôtro".
                </p>
              </div>

              <div class="help-box help-box--tip">
                <h4><i class="ph ph-lightbulb"></i>Poddasze to nie ciasny strych!</h4>
                <p>
                  Liczy siƒô to, czy przestrze≈Ñ pod dachem jest ogrzewana i jak jest oddzielona od
                  ciep≈Çych pomieszcze≈Ñ.
                </p>
                <p>
                  Poddasze to przestrze≈Ñ pod dachem, ze skosami, o wielko≈õci prawie pe≈Çnej
                  kondygnacji. Wybierz "z poddaszem" je≈õli takowa przestrze≈Ñ istnieje.
                </p>
                <p>
                  Nie zaznaczaj poddasza, je≈õli masz tylko niski strych - bardzo niewielkich
                  rozmiar√≥w.
                </p>
              </div>

              <div class="help-box help-box--tip">
                <h4><i class="ph ph-lightbulb"></i> Jaki typ dachu wybraƒá?</h4>
                <p>
                  Liczy siƒô to, czy przestrze≈Ñ pod dachem jest ogrzewana i jak jest oddzielona od
                  ciep≈Çych pomieszcze≈Ñ.
                </p>
                <p>
                  <strong>Dach sko≈õny</strong> nie oznacza automatycznie ogrzewanego poddasza. Mo≈ºe
                  to byƒá zar√≥wno poddasze u≈ºytkowe, jak i zimny strych.
                </p>
                <p>
                  <strong>Dach p≈Çaski</strong> r√≥wnie≈º wymaga uwzglƒôdnienia - straty ciep≈Ça przez
                  dach p≈Çaski sƒÖ tak samo istotne jak przez dach sko≈õny.
                </p>
              </div>

              <div id="atticAccessHelpBox" class="help-box help-box--tip hidden">
                <h4><i class="ph ph-lightbulb"></i>Warunki na poddaszu</h4>
                <p>
                  Chodzi o to, czy przestrze≈Ñ pod dachem jest dobrze oddzielona od ogrzewanych
                  pomieszcze≈Ñ i jak jest tam z izolacjƒÖ.
                </p>
                <p>
                  <strong>Jest u≈ºytkowe, z izolacjƒÖ:</strong> To przestrze≈Ñ, kt√≥ra ma dobrƒÖ izolacjƒô
                  dachu lub stropu nad ostatnim ogrzewanym pomieszczeniem. Dzia≈Ça jak ciep≈Ça
                  poduszka - chroni dom przed stratami ciep≈Ça.
                </p>
                <p>
                  <strong>Kiepsko z izolacjƒÖ:</strong> To zimna przestrze≈Ñ nad domem, gdzie ucieka
                  ciep≈Ço. Mo≈ºe to byƒá strych bez izolacji lub poddasze z nieszczelnym dachem -
                  miejsce, gdzie ucieka ciep≈Ço.
                </p>
              </div>
            </div>
          </div>

          <h3>KUBATURA:</h3>
          <div class="form-row-mosaic form-card">
            <div class="form-field">
              <div class="form-field-item">
                <label class="form-label">Wysoko≈õƒá pomieszcze≈Ñ:</label>
                <input type="hidden" id="floor_height" name="floor_height" value="" required />
                <div class="option-cards option-cards--compact">
                  <button
                    type="button"
                    class="option-card"
                    data-field="floor_height"
                    data-value="2.3"
                    aria-label="Niskie pomieszczenia"
                    tabindex="0"
                  >
                    <span class="option-card__title">2,3 m</span>
                    <span class="option-card__subtitle">Nisko</span>
                  </button>
                  <button
                    type="button"
                    class="option-card"
                    data-field="floor_height"
                    data-value="2.6"
                    aria-label="Standardowa wysoko≈õƒá"
                    tabindex="0"
                  >
                    <span class="option-card__title">2,6 m</span>
                    <span class="option-card__subtitle">Standard</span>
                  </button>
                  <button
                    type="button"
                    class="option-card"
                    data-field="floor_height"
                    data-value="3.1"
                    aria-label="Wysokie pomieszczenia"
                    tabindex="0"
                  >
                    <span class="option-card__title">3,1 m</span>
                    <span class="option-card__subtitle">Wysoko</span>
                  </button>
                  <button
                    type="button"
                    class="option-card"
                    data-field="floor_height"
                    data-value="4.1"
                    aria-label="Bardzo wysokie pomieszczenia"
                    tabindex="0"
                  >
                    <span class="option-card__title">4,1 m</span>
                    <span class="option-card__subtitle">Bardzo wysoko</span>
                  </button>
                </div>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label class="form-label">Czy budynek ma gara≈º w swojej bryle?</label>
                <div class="form-field__radio-group">
                  <label class="form-field__radio-label">
                    <input type="radio" name="garage_type" value="none" required />
                    <span>Brak gara≈ºu w bryle budynku</span>
                  </label>
                  <label class="form-field__radio-label">
                    <input type="radio" name="garage_type" value="single_unheated" required />
                    <span>Jednostanowiskowy - nieogrzewany</span>
                  </label>
                  <label class="form-field__radio-label">
                    <input type="radio" name="garage_type" value="single_heated" required />
                    <span>Jednostanowiskowy - ogrzewany</span>
                  </label>
                  <label class="form-field__radio-label">
                    <input type="radio" name="garage_type" value="double_unheated" required />
                    <span>Dwustanowiskowy - nieogrzewany</span>
                  </label>
                  <label class="form-field__radio-label">
                    <input type="radio" name="garage_type" value="double_heated" required />
                    <span>Dwustanowiskowy - ogrzewany</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
          <!-- Przyciski nawigacyjne -->
          <div
            class="btn-row"
            style="
              display: flex;
              justify-content: center;
              width: 100%;
              gap: 16px;
              grid-column: 1 / -1;
            "
          >
            <button class="btn-next2" type="button" disabled>‚Üí Dalej ‚Üí</button>
            <button class="btn-prev" type="button">‚Üê Cofnij</button>
          </div>
        </div>

        <!-- Zak≈Çadka 2: Konstrukcja -->
        <div class="section" data-tab="2">
          <h3>KONSTRUKCJA I ≈öCIANY ZEWNƒòTRZNE:</h3>

          <div class="form-row-mosaic form-card">
            <div class="form-field">
              <div class="form-field-item">
                <label class="form-label">Wybierz typ konstrukcji budynku:</label>
                <div class="form-field__radio-group">
                  <label class="form-field__radio-label">
                    <input type="radio" name="construction_type" value="traditional" required />
                    <span>Tradycyjna (murowana lub drewniana)</span>
                  </label>
                  <label class="form-field__radio-label">
                    <input type="radio" name="construction_type" value="canadian" required />
                    <span>Szkieletowa (dom kanadyjski)</span>
                  </label>
                </div>
              </div>

              <div id="traditionalOptions">
                <div class="form-field-item form-field-item--subsequent">
                  <label for="primary_wall_material_select"
                    >Z czego wykonane sƒÖ ≈õciany zewnƒôtrzne?</label
                  >
                  <select
                    id="primary_wall_material_select"
                    name="primary_wall_material"
                    class="form-select"
                  >
                    <option value="">-- Wybierz --</option>
                    <option value="84">Porotherm</option>
                    <option value="54">Beton kom√≥rkowy (Ytong, H+H, Termalica)</option>
                    <option value="63">Pustaki ceramiczne</option>
                    <option value="57">Ceg≈Ça pe≈Çna</option>
                    <option value="60">Ceg≈Ça silikatowa</option>
                    <option value="51">Beton</option>
                    <option value="52">≈ªelbet</option>
                    <option value="56">Drewno iglaste</option>
                    <option value="55">Drewno li≈õciaste</option>
                    <option value="53">Pustak ≈ºu≈ºlobetonowy</option>
                    <option value="standard">
                      Nie wiem - standardowe (pustak ceramiczny 25 cm)
                    </option>
                  </select>
                </div>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label for="wall_size" class="form-label"
                  >Grubo≈õƒá zewnƒôtrznych ≈õcian (≈ÇƒÖcznie z ociepleniem):</label
                >

                <div class="custom-slider-container custom-slider-large">
                  <input
                    type="hidden"
                    id="wall_size"
                    name="wall_size"
                    value="50"
                    data-requires-confirm="true"
                    data-slider-confirmed="false"
                  />

                  <div class="custom-bubble" id="customWallSizeBubble">50</div>

                  <div class="custom-slider-track" id="customWallSizeTrack">
                    <div class="custom-slider-thumb" id="customWallSizeThumb"></div>
                  </div>

                  <div class="custom-slider-ticks">
                    <span class="tick" data-value="20">20</span>
                    <span class="tick" data-value="25">25</span>
                    <span class="tick" data-value="30">30</span>
                    <span class="tick" data-value="35">35</span>
                    <span class="tick" data-value="40">40</span>
                    <span class="tick" data-value="45">45</span>
                    <span class="tick" data-value="50">50</span>
                    <span class="tick" data-value="55">55</span>
                    <span class="tick" data-value="60">60</span>
                    <span class="tick" data-value="65">65</span>
                    <span class="tick" data-value="70">70</span>
                    <span class="tick" data-value="75">75</span>
                    <span class="tick" data-value="80">80</span>
                  </div>

                  <button
                    type="button"
                    class="building-type-card slider-confirm-card"
                    data-slider-target="wall_size"
                  >
                    <div class="slider-confirm-card__icon">
                      <i class="ph ph-check"></i>
                    </div>
                    <div class="building-type-card__label">Potwierd≈∫</div>
                    <div class="slider-confirm-card__hint">Zatwierd≈∫ szeroko≈õƒá</div>
                  </button>
                </div>
              </div>
            </div>

            <div class="help-box help-box--tip">
              <h4><i class="ph ph-lightbulb"></i> Wyb√≥r materia≈Çu</h4>
              <p>
                Je≈õli nie masz pewno≈õci co do materia≈Çu, wybierz najbardziej zbli≈ºony do
                rzeczywistego.
              </p>
              <p>Dok≈Çadno≈õƒá tego wyboru wp≈Çywa na precyzjƒô oblicze≈Ñ zapotrzebowania na ciep≈Ço.</p>
            </div>
          </div>

          <h3>DOCIEPLENIE ≈öCIAN:</h3>
          <div class="form-row-mosaic form-card">
            <div class="form-field">
              <div class="hidden" id="canadianOptions" style="display: none">
                <div class="form-field-item">
                  <label for="internal_wall_isolation_material"
                    >Jakim materia≈Çem ocieplono ≈õciany od wewnƒÖtrz?</label
                  >
                  <select
                    id="internal_wall_isolation_material"
                    name="internal_wall_isolation[material]"
                    required
                    class="form-select"
                  >
                    <option value="">-- Wybierz --</option>
                    <option value="68">We≈Çna mineralna</option>
                    <option value="70">Styropian (EPS)</option>
                    <option value="88">Styropian grafitowy</option>
                    <option value="71">Styropian XPS (styrodur)</option>
                    <option value="94">We≈Çna drzewna</option>
                    <option value="95">PIR</option>
                    <option value="86">PUR natryskowy</option>
                    <option value="101">Multipor / inne mineralne</option>
                    <option value="82">Puste powietrze</option>
                  </select>
                </div>
                <div class="form-field-item form-field-item--subsequent">
                  <label for="internal_wall_isolation_size" class="form-label"
                    >Grubo≈õƒá izolacji wewnƒôtrznej (cm) - wymagane</label
                  >

                  <div class="custom-slider-container custom-slider-small">
                    <input
                      type="hidden"
                      id="internal_wall_isolation_size"
                      name="internal_wall_isolation[size]"
                      value="5"
                      required
                      data-requires-confirm="true"
                      data-slider-confirmed="false"
                    />

                    <div class="custom-bubble" id="customInternalInsulationBubble">5</div>

                    <div class="custom-slider-track" id="customInternalInsulationTrack">
                      <div class="custom-slider-thumb" id="customInternalInsulationThumb"></div>
                    </div>

                    <div class="custom-slider-ticks">
                      <span class="tick" data-value="5">5</span>
                      <span class="tick" data-value="10">10</span>
                      <span class="tick" data-value="15">15</span>
                      <span class="tick" data-value="20">20</span>
                      <span class="tick" data-value="25">25</span>
                      <span class="tick" data-value="30">30</span>
                    </div>

                    <button
                      type="button"
                      class="building-type-card slider-confirm-card"
                      data-slider-target="internal_wall_isolation_size"
                    >
                      <div class="slider-confirm-card__icon">
                        <i class="ph ph-check"></i>
                      </div>
                      <div class="building-type-card__label">Potwierd≈∫</div>
                      <div class="slider-confirm-card__hint">Zapisz grubo≈õƒá</div>
                    </button>
                  </div>
                </div>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label class="form-label"
                  >Czy ≈õciany sƒÖ zbudowane z jakiego≈õ dodatkowego materia≈Çu?</label
                >
                <!-- Ukryty input dla kompatybilno≈õci z JavaScript -->
                <input
                  type="hidden"
                  id="has_secondary_wall_material"
                  name="has_secondary_wall_material"
                  value=""
                />
                <!-- Karty Tak/Nie -->
                <div class="yes-no-cards">
                  <button
                    type="button"
                    class="yes-no-card"
                    data-field="has_secondary_wall_material"
                    data-value="yes"
                    aria-label="Tak"
                    tabindex="0"
                  >
                    <span class="yes-no-card__label">Tak</span>
                  </button>
                  <button
                    type="button"
                    class="yes-no-card"
                    data-field="has_secondary_wall_material"
                    data-value="no"
                    aria-label="Nie"
                    tabindex="0"
                  >
                    <span class="yes-no-card__label">Nie</span>
                  </button>
                </div>
              </div>

              <div
                class="hidden form-field-item form-field-item--subsequent"
                id="secondaryWallFields"
              >
                <label for="secondary_wall_material_select"
                  >Dodatkowy materia≈Ç ≈õcian zewnƒôtrznych:</label
                >
                <select
                  id="secondary_wall_material_select"
                  name="secondary_wall_material"
                  class="form-select"
                >
                  <option value="">-- Wybierz --</option>
                  <option value="84">Porotherm</option>
                  <option value="54">Beton kom√≥rkowy (Ytong, H+H, Termalica)</option>
                  <option value="63">Pustaki ceramiczne</option>
                  <option value="57">Ceg≈Ça pe≈Çna</option>
                  <option value="60">Ceg≈Ça silikatowa</option>
                  <option value="51">Beton</option>
                  <option value="52">≈ªelbet</option>
                  <option value="56">Drewno iglaste</option>
                  <option value="55">Drewno li≈õciaste</option>
                  <option value="53">Pustak ≈ºu≈ºlobetonowy</option>
                </select>
              </div>

              <div
                class="form-field-item form-field-item--subsequent"
                id="externalIsolationQuestion"
              >
                <label class="form-label" id="externalIsolationLabel"
                  >Czy budynek jest ocieplony z zewnƒÖtrz?</label
                >
                <!-- Ukryty input dla kompatybilno≈õci z JavaScript -->
                <input
                  type="hidden"
                  id="has_external_isolation"
                  name="has_external_isolation"
                  value=""
                />
                <!-- Karty Tak/Nie -->
                <div class="yes-no-cards">
                  <button
                    type="button"
                    class="yes-no-card"
                    data-field="has_external_isolation"
                    data-value="yes"
                    aria-label="Tak"
                    tabindex="0"
                  >
                    <span class="yes-no-card__label">Tak</span>
                  </button>
                  <button
                    type="button"
                    class="yes-no-card"
                    data-field="has_external_isolation"
                    data-value="no"
                    aria-label="Nie"
                    tabindex="0"
                  >
                    <span class="yes-no-card__label">Nie</span>
                  </button>
                </div>
              </div>

              <div class="hidden" id="externalIsolationFields">
                <div class="form-field-item form-field-item--subsequent">
                  <label for="external_wall_isolation_material" id="externalIsolationMaterialLabel"
                    >Jakim materia≈Çem ocieplono ≈õciany zewnƒôtrzne?</label
                  >
                  <select
                    id="external_wall_isolation_material"
                    name="external_wall_isolation[material]"
                    class="form-select"
                  >
                    <option value="">-- Wybierz --</option>
                    <option value="70">Styropian (EPS)</option>
                    <option value="88">Styropian grafitowy</option>
                    <option value="71">Styropian XPS (styrodur)</option>
                    <option value="68">We≈Çna mineralna</option>
                    <option value="94">We≈Çna drzewna</option>
                    <option value="95">PIR</option>
                    <option value="86">PUR natryskowy</option>
                    <option value="101">Multipor / inne mineralne</option>
                    <option value="82">Puste powietrze</option>
                    <option value="standard">Nie wiem - standardowe (styropian 15 cm)</option>
                  </select>
                </div>

                <div class="form-field-item form-field-item--subsequent">
                  <label
                    for="external_wall_isolation_size"
                    class="form-label"
                    id="externalIsolationSizeLabel"
                    >Grubo≈õƒá warstwy ocieplenia (cm):</label
                  >

                  <div class="custom-slider-container custom-slider-small">
                    <input
                      type="hidden"
                      id="external_wall_isolation_size"
                      name="external_wall_isolation[size]"
                      value="15"
                      data-requires-confirm="true"
                      data-slider-confirmed="false"
                    />

                    <div class="custom-bubble" id="customWallInsulationBubble">15</div>

                    <div class="custom-slider-track" id="customWallInsulationTrack">
                      <div class="custom-slider-thumb" id="customWallInsulationThumb"></div>
                    </div>

                    <div class="custom-slider-ticks">
                      <span class="tick" data-value="5">5</span>
                      <span class="tick" data-value="10">10</span>
                      <span class="tick" data-value="15">15</span>
                      <span class="tick" data-value="20">20</span>
                      <span class="tick" data-value="25">25</span>
                      <span class="tick" data-value="30">30</span>
                      <span class="tick" data-value="35">35</span>
                    </div>

                    <button
                      type="button"
                      class="building-type-card slider-confirm-card"
                      data-slider-target="external_wall_isolation_size"
                    >
                      <div class="slider-confirm-card__icon">
                        <i class="ph ph-check"></i>
                      </div>
                      <div class="building-type-card__label">Potwierd≈∫</div>
                      <div class="slider-confirm-card__hint">Zapisz grubo≈õƒá</div>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div style="display: none">
              <!-- Pusta kolumna dla zachowania uk≈Çadu 2-kolumnowego -->
            </div>
          </div>

          <!-- Przyciski nawigacyjne -->
          <div
            class="btn-row"
            style="display: flex; justify-content: center; width: 100%; gap: 16px"
          >
            <button class="btn-next3" type="button" disabled>‚Üí Dalej ‚Üí</button>
            <button class="btn-prev" type="button">‚Üê Cofnij</button>
          </div>
        </div>

        <!-- Zak≈Çadka 3: Okna i drzwi -->
        <div class="section" data-tab="3">
          <h3>OKNA I DRZWI:</h3>
          <div class="form-row-mosaic form-card">
            <div class="form-field">
              <div class="form-field-item">
                <label for="windows_type">Jakie okna sƒÖ w budynku?</label>
                <select id="windows_type" name="windows_type" required class="form-select">
                  <option value="">-- Wybierz --</option>
                  <option value="2021_triple_glass">Nowoczesne (od 2021), - 3-szybowe</option>
                  <option value="2021_double_glass">Nowoczesne (od 2021) - 2-szybowe</option>
                  <option value="new_triple_glass">Wsp√≥≈Çczesne - 3-szybowe</option>
                  <option value="new_double_glass">Wsp√≥≈Çczesne - 2-szybowe</option>
                  <option value="semi_new_double_glass">
                    Starsze zespolone (typowe z lat 90.)
                  </option>
                  <option value="old_double_glass">Stare okna 2-szybowe</option>
                  <option value="old_single_glass">Stare okna 1-szybowe</option>
                </select>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label for="number_windows" class="form-label"
                  >Ile okien znajduje siƒô w budynku?</label
                >

                <div class="custom-slider-container custom-slider-large">
                  <!-- Ukryty input dla formularza -->
                  <input
                    type="hidden"
                    id="number_windows"
                    name="number_windows"
                    value="14"
                    data-requires-confirm="true"
                    data-slider-confirmed="false"
                  />

                  <!-- BƒÖbelek z warto≈õciƒÖ -->
                  <div class="custom-bubble" id="customWindowsBubble">14</div>

                  <!-- Track slidera -->
                  <div class="custom-slider-track" id="customWindowsTrack">
                    <!-- Thumb (kuleczka) -->
                    <div class="custom-slider-thumb" id="customWindowsThumb"></div>
                  </div>

                  <!-- Znaczniki (ticki) -->
                  <div class="custom-slider-ticks">
                    <span class="tick" data-value="4">4</span>
                    <span class="tick" data-value="8">8</span>
                    <span class="tick" data-value="12">12</span>
                    <span class="tick" data-value="16">16</span>
                    <span class="tick" data-value="20">20</span>
                    <span class="tick" data-value="24">24</span>
                  </div>

                  <button
                    type="button"
                    class="building-type-card slider-confirm-card"
                    data-slider-target="number_windows"
                  >
                    <div class="slider-confirm-card__icon">
                      <i class="ph ph-check"></i>
                    </div>
                    <div class="building-type-card__label">Potwierd≈∫</div>
                    <div class="slider-confirm-card__hint">Zapisz liczbƒô</div>
                  </button>
                </div>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label for="number_huge_windows" class="form-label"
                  >Podaj ilo≈õƒá, je≈õli budynku sƒÖ du≈ºe przeszklenia (np. okna tarasowe, HS):</label
                >

                <div class="custom-slider-container custom-slider-small">
                  <!-- Ukryty input dla formularza -->
                  <input
                    type="hidden"
                    id="number_huge_windows"
                    name="number_huge_windows"
                    value="0"
                    data-requires-confirm="true"
                    data-slider-confirmed="false"
                  />

                  <!-- BƒÖbelek z warto≈õciƒÖ -->
                  <div class="custom-bubble" id="customHugeWindowsBubble">0</div>

                  <!-- Track slidera -->
                  <div class="custom-slider-track" id="customHugeWindowsTrack">
                    <!-- Thumb (kuleczka) -->
                    <div class="custom-slider-thumb" id="customHugeWindowsThumb"></div>
                  </div>

                  <!-- Znaczniki (ticki) -->
                  <div class="custom-slider-ticks">
                    <span class="tick" data-value="0">0</span>
                    <span class="tick" data-value="1">1</span>
                    <span class="tick" data-value="2">2</span>
                    <span class="tick" data-value="3">3</span>
                    <span class="tick" data-value="4">4</span>
                    <span class="tick" data-value="5">5</span>
                  </div>

                  <button
                    type="button"
                    class="building-type-card slider-confirm-card"
                    data-slider-target="number_huge_windows"
                  >
                    <div class="slider-confirm-card__icon">
                      <i class="ph ph-check"></i>
                    </div>
                    <div class="building-type-card__label">Potwierd≈∫</div>
                    <div class="slider-confirm-card__hint">Zapisz liczbƒô</div>
                  </button>
                </div>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label for="doors_type">Jakie sƒÖ drzwi zewnƒôtrzne?</label>
                <select id="doors_type" name="doors_type" required class="form-select">
                  <option value="">-- Wybierz --</option>
                  <option value="new_pvc">Nowe PVC</option>
                  <option value="new_wooden">Nowe drewniane</option>
                  <option value="new_metal">Nowe metalowe</option>
                  <option value="old_wooden">Stare drewniane</option>
                  <option value="old_metal">Stare metalowe</option>
                </select>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label for="number_doors" class="form-label"
                  >Ile drzwi zewnƒôtrznych (wyj≈õƒá) znajduje siƒô w budynku?</label
                >

                <div class="custom-slider-container custom-slider-small">
                  <!-- Ukryty input dla formularza -->
                  <input type="hidden" id="number_doors" name="number_doors" value="1" />

                  <!-- BƒÖbelek z warto≈õciƒÖ -->
                  <div class="custom-bubble" id="customDoorsBubble">1</div>

                  <!-- Track slidera -->
                  <div class="custom-slider-track" id="customDoorsTrack">
                    <!-- Thumb (kuleczka) -->
                    <div class="custom-slider-thumb" id="customDoorsThumb"></div>
                  </div>

                  <!-- Znaczniki (ticki) -->
                  <div class="custom-slider-ticks">
                    <span class="tick" data-value="1">1</span>
                    <span class="tick" data-value="2">2</span>
                    <span class="tick" data-value="3">3</span>
                    <span class="tick" data-value="4">4</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="help-box help-box--tip">
              <h4><i class="ph ph-lightbulb"></i> Jak liczyƒá okna?</h4>
              <p>
                Mniejsze okna nale≈ºy liczyƒá jako p√≥≈Ç, okna dachowe jako 1, a ma≈Çe dachowe jako p√≥≈Ç.
              </p>
            </div>
          </div>

          <!-- Przyciski nawigacyjne -->
          <div
            class="btn-row"
            style="display: flex; justify-content: center; width: 100%; gap: 16px"
          >
            <button class="btn-next4" type="button" disabled>‚Üí Dalej ‚Üí</button>
            <button class="btn-prev" type="button">‚Üê Cofnij</button>
          </div>
        </div>

        <!-- Zak≈Çadka 4: Izolacje -->
        <div class="section" data-tab="4">
          <!-- UPROSZCZONY TRYB DLA SINGLE_HOUSE -->
          <div id="simplifiedInsulationMode" class="hidden">
            <h3>OCIEPLENIE BUDYNKU:</h3>
            <div class="form-row-mosaic form-card">
              <div class="form-field">
                <!-- Checkbox do prze≈ÇƒÖczania trybu -->
                <div class="form-field-item" style="margin-bottom: 24px">
                  <label
                    class="form-label"
                    style="display: flex; align-items: center; gap: 12px; cursor: pointer"
                  >
                    <input
                      type="checkbox"
                      id="detailed_insulation_mode"
                      name="detailed_insulation_mode"
                      style="width: 20px; height: 20px; cursor: pointer"
                    />
                    <span>Chcƒô podaƒá precyzyjne parametry ocieplenia mojego budynku</span>
                  </label>
                </div>

                <!-- Uproszczone pytanie 1: ≈öciany -->
                <div class="form-field-item">
                  <label class="form-label">Jak sƒÖ ocieplone ≈õciany budynku?</label>
                  <input
                    type="hidden"
                    id="walls_insulation_level"
                    name="walls_insulation_level"
                    value=""
                  />
                  <div class="option-cards option-cards--wide">
                    <button
                      type="button"
                      class="option-card"
                      data-field="walls_insulation_level"
                      data-value="poor"
                      aria-label="Brak / bardzo s≈Çabe"
                      tabindex="0"
                    >
                      <span class="option-card__title">S≈Çabo ocieplone</span>
                    </button>
                    <button
                      type="button"
                      class="option-card"
                      data-field="walls_insulation_level"
                      data-value="average"
                      aria-label="Przeciƒôtnie ocieplone"
                      tabindex="0"
                    >
                      <span class="option-card__title">Przeciƒôtnie ocieplone</span>
                    </button>
                    <button
                      type="button"
                      class="option-card"
                      data-field="walls_insulation_level"
                      data-value="good"
                      aria-label="Dobrze ocieplone"
                      tabindex="0"
                    >
                      <span class="option-card__title">Dobrze ocieplone</span>
                    </button>
                    <button
                      type="button"
                      class="option-card"
                      data-field="walls_insulation_level"
                      data-value="very_good"
                      aria-label="Bardzo dobrze ocieplone"
                      tabindex="0"
                    >
                      <span class="option-card__title">Bardzo dobrze ocieplone</span>
                    </button>
                  </div>
                </div>

                <!-- Uproszczone pytanie 2: Dach -->
                <div class="form-field-item form-field-item--subsequent">
                  <label class="form-label"
                    >Jak ocieplony jest dach lub strop nad ostatniƒÖ ogrzewanƒÖ kondygnacjƒÖ?</label
                  >
                  <input
                    type="hidden"
                    id="roof_insulation_level"
                    name="roof_insulation_level"
                    value=""
                  />
                  <div class="option-cards option-cards--wide">
                    <button
                      type="button"
                      class="option-card"
                      data-field="roof_insulation_level"
                      data-value="poor"
                      aria-label="Brak / bardzo s≈Çabe"
                      tabindex="0"
                    >
                      <span class="option-card__title">S≈Çabo ocieplone</span>
                    </button>
                    <button
                      type="button"
                      class="option-card"
                      data-field="roof_insulation_level"
                      data-value="average"
                      aria-label="Przeciƒôtnie ocieplone"
                      tabindex="0"
                    >
                      <span class="option-card__title">Przeciƒôtnie ocieplone</span>
                    </button>
                    <button
                      type="button"
                      class="option-card"
                      data-field="roof_insulation_level"
                      data-value="good"
                      aria-label="Dobrze ocieplone"
                      tabindex="0"
                    >
                      <span class="option-card__title">Dobrze ocieplone</span>
                    </button>
                    <button
                      type="button"
                      class="option-card"
                      data-field="roof_insulation_level"
                      data-value="very_good"
                      aria-label="Bardzo dobrze ocieplone"
                      tabindex="0"
                    >
                      <span class="option-card__title">Bardzo dobrze ocieplone</span>
                    </button>
                  </div>
                </div>

                <!-- Uproszczone pytanie 3: Pod≈Çoga -->
                <div class="form-field-item form-field-item--subsequent">
                  <label class="form-label"
                    >Jak ocieplona jest pod≈Çoga (na gruncie / nad piwnicƒÖ)?</label
                  >
                  <input
                    type="hidden"
                    id="floor_insulation_level"
                    name="floor_insulation_level"
                    value=""
                  />
                  <div class="option-cards option-cards--wide">
                    <button
                      type="button"
                      class="option-card"
                      data-field="floor_insulation_level"
                      data-value="poor"
                      aria-label="Brak / bardzo s≈Çabe"
                      tabindex="0"
                    >
                      <span class="option-card__title">S≈Çabo ocieplone</span>
                    </button>
                    <button
                      type="button"
                      class="option-card"
                      data-field="floor_insulation_level"
                      data-value="average"
                      aria-label="Przeciƒôtnie ocieplone"
                      tabindex="0"
                    >
                      <span class="option-card__title">Przeciƒôtnie ocieplone</span>
                    </button>
                    <button
                      type="button"
                      class="option-card"
                      data-field="floor_insulation_level"
                      data-value="good"
                      aria-label="Dobrze ocieplone"
                      tabindex="0"
                    >
                      <span class="option-card__title">Dobrze ocieplone</span>
                    </button>
                    <button
                      type="button"
                      class="option-card"
                      data-field="floor_insulation_level"
                      data-value="very_good"
                      aria-label="Bardzo dobrze ocieplone"
                      tabindex="0"
                    >
                      <span class="option-card__title">Bardzo dobrze ocieplone</span>
                    </button>
                  </div>
                </div>
              </div>

              <div class="help-box help-box--tip">
                <h4><i class="ph ph-lightbulb"></i> Uproszczony tryb</h4>
                <p>
                  W trybie uproszczonym wybierasz og√≥lny poziom ocieplenia. Je≈õli znasz dok≈Çadne
                  parametry (materia≈Ç i grubo≈õƒá izolacji), zaznacz checkbox powy≈ºej, aby przej≈õƒá do
                  trybu szczeg√≥≈Çowego.
                </p>
              </div>
            </div>
          </div>

          <!-- SZCZEG√ì≈ÅOWY TRYB (oryginalny) -->
          <div id="detailedInsulationMode">
            <h3>DOCIEPLENIE DACHU:</h3>
            <div class="form-row-mosaic form-card">
              <div class="form-field">
                <div class="form-field-item">
                  <label class="form-label" id="topIsolationLabel">Czy dach jest ocieplony</label>
                  <!-- Ukryty input dla kompatybilno≈õci z JavaScript -->
                  <input type="hidden" id="top_isolation" name="top_isolation" value="" />
                  <!-- Karty Tak/Nie -->
                  <div class="yes-no-cards">
                    <button
                      type="button"
                      class="yes-no-card"
                      data-field="top_isolation"
                      data-value="yes"
                      aria-label="Tak"
                      tabindex="0"
                    >
                      <span class="yes-no-card__label">Tak</span>
                    </button>
                    <button
                      type="button"
                      class="yes-no-card"
                      data-field="top_isolation"
                      data-value="no"
                      aria-label="Nie"
                      tabindex="0"
                    >
                      <span class="yes-no-card__label">Nie</span>
                    </button>
                  </div>
                </div>

                <div id="topIsolationFields" class="hidden" style="display: none">
                  <div class="form-field-item form-field-item--subsequent">
                    <label for="top_isolation_material" id="topIsolationMaterialLabel"
                      >Jakim materia≈Çem ocieplono dach?</label
                    >
                    <select
                      id="top_isolation_material"
                      name="top_isolation[material]"
                      class="form-select"
                    >
                      <option value="">-- Wybierz --</option>
                      <option value="68">We≈Çna mineralna</option>
                      <option value="70">Styropian (EPS)</option>
                      <option value="71">Styropian XPS (styrodur)</option>
                      <option value="88">Styropian grafitowy</option>
                      <option value="95">PIR</option>
                      <option value="86">PUR natryskowy</option>
                      <option value="94">We≈Çna drzewna</option>
                      <option value="101">Multipor / inne mineralne</option>
                      <option value="82">Puste powietrze</option>
                      <option value="standard">Nie wiem - standardowe (we≈Çna 20 cm)</option>
                    </select>
                  </div>

                  <div class="form-field-item form-field-item--subsequent">
                    <label for="top_isolation_size" class="form-label" id="topIsolationSizeLabel"
                      >Grubo≈õƒá izolacji dachu (cm):</label
                    >

                    <div class="custom-slider-container custom-slider-small">
                      <input
                        type="hidden"
                        id="top_isolation_size"
                        name="top_isolation[size]"
                        value="30"
                        data-requires-confirm="true"
                        data-slider-confirmed="false"
                      />

                      <div class="custom-bubble" id="customRoofInsulationBubble">30</div>

                      <div class="custom-slider-track" id="customRoofInsulationTrack">
                        <div class="custom-slider-thumb" id="customRoofInsulationThumb"></div>
                      </div>

                      <div class="custom-slider-ticks">
                        <span class="tick" data-value="10">10</span>
                        <span class="tick" data-value="15">15</span>
                        <span class="tick" data-value="20">20</span>
                        <span class="tick" data-value="25">25</span>
                        <span class="tick" data-value="30">30</span>
                        <span class="tick" data-value="35">35</span>
                        <span class="tick" data-value="40">40</span>
                        <span class="tick" data-value="45">45</span>
                      </div>

                      <button
                        type="button"
                        class="building-type-card slider-confirm-card"
                        data-slider-target="top_isolation_size"
                      >
                        <div class="slider-confirm-card__icon">
                          <i class="ph ph-check"></i>
                        </div>
                        <div class="building-type-card__label">Potwierd≈∫</div>
                        <div class="slider-confirm-card__hint">Zapisz grubo≈õƒá</div>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="help-box help-box--tip">
                <h4><i class="ph ph-lightbulb"></i>Izolacja od g√≥ry</h4>
                <p id="topIsolationDescription">
                  Docieplenie przestrzeni ogrzewanej od g√≥ry - mo≈ºe to byƒá strop nad ostatnim
                  ogrzewanym pomieszczeniem lub dach.
                </p>
                <p>
                  Brak izolacji lub jej niewystarczajƒÖca grubo≈õƒá zwiƒôksza straty ciep≈Ça przez dach,
                  co podnosi zapotrzebowanie na moc pompy i koszty eksploatacji.
                </p>
                <p>
                  Efekt ten jest szczeg√≥lnie odczuwalny podczas niskich temperatur oraz w d≈Çugim
                  okresie u≈ºytkowania instalacji.
                </p>
              </div>
            </div>
            <h3>DOCIEPLENIE POD≈ÅOGI:</h3>
            <div class="form-row-mosaic form-card">
              <div class="form-field">
                <div class="form-field-item">
                  <label class="form-label">Czy pod≈Çoga jest ocieplona?</label>
                  <!-- Ukryty input dla kompatybilno≈õci z JavaScript -->
                  <input type="hidden" id="bottom_isolation" name="bottom_isolation" value="" />
                  <!-- Karty Tak/Nie -->
                  <div class="yes-no-cards">
                    <button
                      type="button"
                      class="yes-no-card"
                      data-field="bottom_isolation"
                      data-value="yes"
                      aria-label="Tak"
                      tabindex="0"
                    >
                      <span class="yes-no-card__label">Tak</span>
                    </button>
                    <button
                      type="button"
                      class="yes-no-card"
                      data-field="bottom_isolation"
                      data-value="no"
                      aria-label="Nie"
                      tabindex="0"
                    >
                      <span class="yes-no-card__label">Nie</span>
                    </button>
                  </div>
                </div>

                <div id="bottomIsolationFields" class="hidden" style="display: none">
                  <div class="form-field-item form-field-item--subsequent">
                    <label for="bottom_isolation_material"
                      >Jakim materia≈Çem ocieplono pod≈Çogƒô?</label
                    >
                    <select
                      id="bottom_isolation_material"
                      name="bottom_isolation[material]"
                      class="form-select"
                    >
                      <option value="">-- Wybierz --</option>
                      <option value="70">Styropian (EPS)</option>
                      <option value="88">Styropian grafitowy</option>
                      <option value="71">Styropian XPS (styrodur)</option>
                      <option value="68">We≈Çna mineralna</option>
                      <option value="95">PIR</option>
                      <option value="86">PUR natryskowy</option>
                      <option value="101">Multipor / inne mineralne</option>
                      <option value="82">Puste powietrze</option>
                      <option value="standard">Nie wiem - standardowe (styropian 15 cm)</option>
                    </select>
                  </div>

                  <div class="form-field-item form-field-item--subsequent">
                    <label for="bottom_isolation_size" class="form-label"
                      >Grubo≈õƒá ocieplenia pod≈Çogi (cm):</label
                    >

                    <div class="custom-slider-container custom-slider-small">
                      <input
                        type="hidden"
                        id="bottom_isolation_size"
                        name="bottom_isolation[size]"
                        value="15"
                      />

                      <div class="custom-bubble" id="customFloorInsulationBubble">15</div>

                      <div class="custom-slider-track" id="customFloorInsulationTrack">
                        <div class="custom-slider-thumb" id="customFloorInsulationThumb"></div>
                      </div>

                      <div class="custom-slider-ticks">
                        <span class="tick" data-value="5">5</span>
                        <span class="tick" data-value="10">10</span>
                        <span class="tick" data-value="15">15</span>
                        <span class="tick" data-value="20">20</span>
                        <span class="tick" data-value="25">25</span>
                        <span class="tick" data-value="30">30</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="help-box help-box--tip">
                <h4><i class="ph ph-lightbulb"></i> Ocieplenie pod≈Çogi</h4>
                <p>
                  Ocieplenie pod≈Çogi na gruncie lub stropu nad nieogrzewanƒÖ piwnicƒÖ wp≈Çywa na
                  zmniejszenie strat ciep≈Ça przez pod≈Çogƒô.
                </p>
                <p>
                  Brak odpowiedniego ocieplenia pod≈Çogi zwiƒôksza straty ciep≈Ça, co podnosi
                  zapotrzebowanie na moc pompy i koszty eksploatacji. Skutki sƒÖ szczeg√≥lnie
                  odczuwalne podczas mroz√≥w oraz w wieloletniej eksploatacji systemu.
                </p>
              </div>
            </div>
          </div>
          <!-- Koniec detailedInsulationMode -->

          <!-- Przyciski nawigacyjne -->
          <div
            class="btn-row"
            style="display: flex; justify-content: center; width: 100%; gap: 16px"
          >
            <button class="btn-next5" type="button" disabled>‚Üí Dalej ‚Üí</button>
            <button class="btn-prev" type="button">‚Üê Cofnij</button>
          </div>
        </div>

        <!-- Zak≈Çadka 5: Ogrzewanie i CWU -->
        <div class="section" data-tab="5">
          <h3>OGRZEWANIE:</h3>
          <div class="form-row-mosaic form-card">
            <div class="form-field">
              <div class="form-field-item">
                <label for="source_type">G≈Ç√≥wne ≈∫r√≥d≈Ço ogrzewania</label>
                <select id="source_type" name="source_type" required class="form-select">
                  <option value="">-- Wybierz --</option>
                  <option value="air_to_water_hp">Pompa ciep≈Ça powietrze-woda</option>
                  <option value="gas">Gaz</option>
                  <option value="oil">Olej</option>
                  <option value="biomass">Biomasa</option>
                  <option value="district_heating">Ciep≈Ço sieciowe</option>
                </select>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label for="indoor_temperature" class="form-label"
                  >Jaka jest Twoja komfortowa temperatura?</label
                >

                <div class="custom-slider-container custom-slider-small">
                  <input
                    type="hidden"
                    id="indoor_temperature"
                    name="indoor_temperature"
                    value="21"
                    data-requires-confirm="true"
                    data-slider-confirmed="false"
                  />

                  <div class="custom-bubble" id="customTemperatureBubble">21</div>

                  <div class="custom-slider-track" id="customTemperatureTrack">
                    <div class="custom-slider-thumb" id="customTemperatureThumb"></div>
                  </div>

                  <div class="custom-slider-ticks">
                    <span class="tick" data-value="17">17</span>
                    <span class="tick" data-value="18">18</span>
                    <span class="tick" data-value="19">19</span>
                    <span class="tick" data-value="20">20</span>
                    <span class="tick" data-value="21">21</span>
                    <span class="tick" data-value="22">22</span>
                    <span class="tick" data-value="23">23</span>
                    <span class="tick" data-value="24">24</span>
                    <span class="tick" data-value="25">25</span>
                  </div>

                  <button
                    type="button"
                    class="building-type-card slider-confirm-card"
                    data-slider-target="indoor_temperature"
                  >
                    <div class="slider-confirm-card__icon">
                      <i class="ph ph-check"></i>
                    </div>
                    <div class="building-type-card__label">Potwierd≈∫</div>
                    <div class="slider-confirm-card__hint">Zapisz komfort</div>
                  </button>
                </div>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label class="form-label">Typ wentylacji:</label>
                <input
                  type="hidden"
                  id="ventilation_type"
                  name="ventilation_type"
                  value=""
                  required
                />
                <div class="option-cards option-cards--wide">
                  <button
                    type="button"
                    class="option-card"
                    data-field="ventilation_type"
                    data-value="natural"
                    aria-label="Wentylacja naturalna"
                    tabindex="0"
                  >
                    <span class="option-card__title">Naturalna</span>
                    <span class="option-card__subtitle">Grawitacyjna</span>
                  </button>
                  <button
                    type="button"
                    class="option-card"
                    data-field="ventilation_type"
                    data-value="mechanical"
                    aria-label="Wentylacja mechaniczna"
                    tabindex="0"
                  >
                    <span class="option-card__title">Mechaniczna</span>
                    <span class="option-card__subtitle">Bez rekuperacji</span>
                  </button>
                  <button
                    type="button"
                    class="option-card"
                    data-field="ventilation_type"
                    data-value="mechanical_recovery"
                    aria-label="Wentylacja z rekuperacjƒÖ"
                    tabindex="0"
                  >
                    <span class="option-card__title">Rekuperacja</span>
                    <span class="option-card__subtitle">Mechaniczna z odzyskiem</span>
                  </button>
                </div>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label class="form-label">Rodzaj ogrzewania w budynku:</label>
                <input type="hidden" id="heating_type" name="heating_type" value="" required />
                <div class="option-cards option-cards--wide">
                  <button
                    type="button"
                    class="option-card"
                    data-field="heating_type"
                    data-value="underfloor"
                    aria-label="Ogrzewanie pod≈Çogowe"
                    tabindex="0"
                  >
                    <span class="option-card__title">Pod≈Çogowe</span>
                    <span class="option-card__subtitle">Jedna strefa</span>
                  </button>
                  <button
                    type="button"
                    class="option-card"
                    data-field="heating_type"
                    data-value="radiators"
                    aria-label="Ogrzewanie grzejnikowe"
                    tabindex="0"
                  >
                    <span class="option-card__title">Grzejniki</span>
                    <span class="option-card__subtitle">Kaloryfery</span>
                  </button>
                  <button
                    type="button"
                    class="option-card"
                    data-field="heating_type"
                    data-value="mixed"
                    aria-label="Ogrzewanie mieszane"
                    tabindex="0"
                  >
                    <span class="option-card__title">Mieszane</span>
                    <span class="option-card__subtitle">Pod≈Çoga + grzejniki</span>
                  </button>
                </div>
              </div>
            </div>

            <div class="help-box help-box--tip">
              <h4><i class="ph ph-lightbulb"></i> Kiedy wybraƒá "mieszane"?</h4>
              <p>
                Je≈ºeli masz pod≈Çog√≥wkƒô i np. dodatkowe 2 grzejniki ≈Çazienkowe - w dalszym ciƒÖgu
                wybierasz ogrzewanie pod≈Çogowe. Uk≈Çad mieszany wybierasz, gdy faktycznie masz 2
                strefy z r√≥≈ºnymi odbiornikami ciep≈Ça.
              </p>
              <p>
                Rodzaj instalacji grzewczej wp≈Çywa na temperaturƒô zasilania. Ni≈ºsza temperatura
                (ogrzewanie pod≈Çogowe) oznacza wy≈ºszƒÖ sprawno≈õƒá pompy, cichszƒÖ i stabilniejszƒÖ
                pracƒô.
              </p>
              <p>
                Uk≈Çady mieszane wymagajƒÖ starannego doboru i regulacji, aby zachowaƒá wysokƒÖ
                sprawno≈õƒá pompy.
              </p>
            </div>
          </div>
          <h3>CIEP≈ÅA WODA::</h3>
          <div class="form-row-mosaic form-card">
            <div class="form-field">
              <div class="form-field-item">
                <label class="form-label">Czy pompa ma te≈º podgrzewaƒá wodƒô u≈ºytkowƒÖ (CWU)?</label>
                <!-- Ukryty input dla kompatybilno≈õci z JavaScript -->
                <input type="hidden" id="include_hot_water" name="include_hot_water" value="yes" />
                <!-- Karty Tak/Nie -->
                <div class="yes-no-cards">
                  <button
                    type="button"
                    class="yes-no-card yes-no-card--selected"
                    data-field="include_hot_water"
                    data-value="yes"
                    aria-label="Tak"
                    tabindex="0"
                  >
                    <span class="yes-no-card__label">Tak</span>
                  </button>
                  <button
                    type="button"
                    class="yes-no-card"
                    data-field="include_hot_water"
                    data-value="no"
                    aria-label="Nie"
                    tabindex="0"
                  >
                    <span class="yes-no-card__label">Nie</span>
                  </button>
                </div>
              </div>

              <div class="form-field-item form-field-item--subsequent">
                <label class="form-label">Ile os√≥b mieszka w budynku?</label>

                <div class="custom-slider-container custom-slider-small">
                  <input
                    type="hidden"
                    id="hot_water_persons"
                    name="hot_water_persons"
                    value="4"
                    data-requires-confirm="true"
                    data-slider-confirmed="false"
                  />
                  <div class="custom-bubble" id="customPersonsBubble">4</div>
                  <div class="custom-slider-track" id="customPersonsTrack">
                    <div class="custom-slider-thumb" id="customPersonsThumb"></div>
                  </div>
                  <div class="custom-slider-ticks">
                    <span class="tick" data-value="2" data-label="1-2">1-2</span>
                    <span class="tick" data-value="3" data-label="3">3</span>
                    <span class="tick" data-value="4" data-label="4">4</span>
                    <span class="tick" data-value="6" data-label="5-6">5-6</span>
                    <span class="tick" data-value="8" data-label="7+">7+</span>
                  </div>

                  <button
                    type="button"
                    class="building-type-card slider-confirm-card"
                    data-slider-target="hot_water_persons"
                  >
                    <div class="slider-confirm-card__icon">
                      <i class="ph ph-check"></i>
                    </div>
                    <div class="building-type-card__label">Potwierd≈∫</div>
                    <div class="slider-confirm-card__hint">Zapisz liczbƒô</div>
                  </button>
                </div>
              </div>

              <div id="hotWaterOptions" class="form-field-item form-field-item--subsequent">
                <label class="form-label">Jakie jest zu≈ºycie ciep≈Çej wody?</label>
                <input
                  type="hidden"
                  id="hot_water_usage"
                  name="hot_water_usage"
                  value="shower_bath"
                  required
                />
                <div class="option-cards option-cards--wide">
                  <button
                    type="button"
                    class="option-card"
                    data-field="hot_water_usage"
                    data-value="shower"
                    aria-label="Ma≈Çe zu≈ºycie CWU"
                    tabindex="0"
                  >
                    <span class="option-card__title">Ma≈Çe</span>
                    <span class="option-card__subtitle">Prysznic / umywalka</span>
                  </button>
                  <button
                    type="button"
                    class="option-card"
                    data-field="hot_water_usage"
                    data-value="shower_bath"
                    aria-label="≈örednie zu≈ºycie CWU"
                    tabindex="0"
                  >
                    <span class="option-card__title">≈örednie</span>
                    <span class="option-card__subtitle">Prysznic + wanna</span>
                  </button>
                  <button
                    type="button"
                    class="option-card"
                    data-field="hot_water_usage"
                    data-value="bath"
                    aria-label="Du≈ºe zu≈ºycie CWU"
                    tabindex="0"
                  >
                    <span class="option-card__title">Du≈ºe</span>
                    <span class="option-card__subtitle">Czƒôste kƒÖpiele</span>
                  </button>
                </div>
              </div>
            </div>

            <div class="help-box help-box--tip">
              <h4><i class="ph ph-lightbulb"></i>Ogrzewanie + ciep≈Ça woda</h4>
              <p>
                Wy≈ÇƒÖcz tylko je≈õli posiadasz inne ≈∫r√≥d≈Ço ciep≈Çej wody i nie zamierzasz ogrzewaƒá
                zasobnika na wodƒô kranowƒÖ za pomocƒÖ pompy ciep≈Ça.
              </p>
            </div>

            <div id="hotWaterUsageHelpBox" class="help-box help-box--tip" style="display: none">
              <h4><i class="ph ph-lightbulb"></i> Jak okre≈õliƒá zu≈ºycie wody?</h4>
              <p>Du≈ºe zu≈ºycie ciep≈Çej wody wymaga odpowiedniego zapasu wody w zasobniku.</p>
              <p>
                Zbyt ma≈Çy zasobnik oznacza spadki komfortu przy jednoczesnym korzystaniu z kilku
                punkt√≥w poboru - woda mo≈ºe siƒô szybko ko≈Ñczyƒá.
              </p>
            </div>
          </div>

          <!-- Przyciski nawigacyjne -->
          <div
            class="btn-row"
            style="display: flex; justify-content: center; width: 100%; gap: 16px"
          >
            <button class="btn-finish" type="button" disabled>‚Üí SPRAWD≈π WYNIK ‚Üí</button>
            <button class="btn-prev" type="button">‚Üê Cofnij</button>
          </div>
        </div>

        <!-- ZORDON 3.0 - Sekcja Wynik√≥w Ultra Premium -->
        <section class="results-wrapper section" data-tab="6">
          <!-- üî• STICKY SWITCHER - Prze≈ÇƒÖcznik zak≈Çadek -->
          <div id="results-switcher" class="results-switcher glass-box">
            <button
              type="button"
              class="results-switch-btn active"
              data-target="configurator-view"
              aria-pressed="true"
            >
              <i class="fas fa-cogs"></i>
              <span>Twoja Maszynownia</span>
            </button>
            <button
              type="button"
              class="results-switch-btn"
              data-target="energy-profile-view"
              aria-pressed="false"
            >
              <i class="fas fa-chart-line"></i>
              <span>Profil Energetyczny</span>
            </button>
          </div>

          <!-- üì¶ WIDOK 1: KONFIGURATOR MASZYNOWNI (≈Çadowany z konfigurator.html) -->
          <div id="configurator-view" class="results-view visible"></div>

          <!-- üìä WIDOK 2: PROFIL ENERGETYCZNY (domy≈õlnie ukryty) -->
          <div id="energy-profile-view" class="results-view hidden">
            <!-- PROFIL ENERGETYCZNY - WYNIKI OBLICZE≈É -->
            <div class="energy-profile-section glass-box accordion-section">
              <h2 class="result-title">Tw√≥j profil energetyczny:</h2>
              <p class="result-subtitle">
                Kompleksowa analiza zapotrzebowania na ciep≈Ço dla Twojego budynku
              </p>

              <div class="result-grid">
                <div class="result-item">
                  <span class="icon-squares">Powierzchnia ca≈Çkowita</span>
                  <strong id="r-total-area">...</strong>
                </div>
                <div class="result-item">
                  <span class="icon-flame">Powierzchnia ogrzewana</span>
                  <strong id="r-heated-area">...</strong>
                </div>
                <div class="result-item">
                  <span class="icon-power">Moc maksymalna (c.o.)</span>
                  <strong id="r-max-power">...</strong>
                </div>
                <div class="result-item">
                  <span class="icon-drop">Moc CWU</span> <strong id="r-cwu">...</strong>
                </div>
                <div class="result-item">
                  <span class="icon-chart">Zu≈ºycie roczne</span> <strong id="r-energy">...</strong>
                </div>
                <div class="result-item">
                  <span class="icon-thermometer">Temperatura projektowa</span>
                  <strong id="r-temp">...</strong>
                </div>
                <div class="result-item">
                  <span class="icon-target">Punkt biwalentny</span>
                  <strong id="r-bi-power">...</strong>
                </div>
                <div class="result-item">
                  <span class="icon-globe">Temperatura ≈õrednioroczna</span>
                  <strong id="r-temp-avg">...</strong>
                </div>
                <div class="result-item">
                  <span class="icon-power">Moc ≈õrednia</span> <strong id="r-avg-power">...</strong>
                </div>
              </div>
            </div>

            <!-- Komentarz systemowy po profilu energetycznym -->
            <div class="data-comment" id="system-comment">
              <i class="fas fa-info-circle"></i>
              <span id="system-comment-text"
                >Parametry budynku sƒÖ sp√≥jne i pozwalajƒÖ na bezpiecznƒÖ pracƒô pompy ciep≈Ça. System
                nie wykry≈Ç ryzyk przewymiarowania ani niedoboru mocy.</span
              >
            </div>

            <!-- DANE ROZSZERZONE (ukryte domy≈õlnie) -->
            <div id="extended-results-sections">
              <!-- STRATY CIEP≈ÅA -->
              <div class="extended-section accordion-section collapsed">
                <h3 class="section-title"><i class="fas fa-chart-pie"></i> Analiza strat ciep≈Ça</h3>
                <div class="accordion-content">
                  <p class="section-subtitle">Rozk≈Çad strat energii w Twoim budynku</p>
                  <div id="energy-losses-container"></div>
                  <p class="summary-line">
                    Wyniki pokazujƒÖ, ≈ºe budynek ma bardzo dobre parametry izolacji ‚Äì pompa ciep≈Ça
                    bƒôdzie pracowaƒá stabilnie i z niskimi kosztami eksploatacji.
                  </p>
                </div>
              </div>

              <!-- PROPOZYCJE MODERNIZACJI -->
              <div class="extended-section accordion-section collapsed">
                <h3 class="section-title">
                  <i class="fas fa-lightbulb"></i> Rekomendowane modernizacje
                </h3>
                <div class="accordion-content">
                  <p class="section-subtitle">Najbardziej op≈Çacalne usprawnienia energetyczne</p>
                  <div id="improvements-container"></div>
                </div>
              </div>

              <!-- KOSZTY OGRZEWANIA -->
              <div class="extended-section accordion-section">
                <h3 class="section-title">
                  <i class="fas fa-coins"></i> Por√≥wnanie koszt√≥w ogrzewania
                </h3>
                <div class="accordion-content">
                  <p class="section-subtitle">Roczne koszty dla r√≥≈ºnych ≈∫r√≥de≈Ç ciep≈Ça</p>
                  <div id="heating-costs-container"></div>
                </div>
              </div>

              <!-- PUNKTY BIWALENTNE -->
              <div class="extended-section accordion-section collapsed">
                <h3 class="section-title">
                  <i class="fas fa-thermometer-three-quarters"></i> Punkty biwalentne
                </h3>
                <div class="accordion-content">
                  <p class="section-subtitle">Wydajno≈õƒá pompy ciep≈Ça przy r√≥≈ºnych temperaturach</p>
                  <div id="bivalent-points-container"></div>
                  <p class="comfort-line">
                    Pompa utrzymuje pe≈ÇnƒÖ moc nawet przy -7¬∞C ‚Äî to oznacza stabilne ciep≈Ço bez
                    dogrzewania elektrycznego.
                  </p>
                </div>
              </div>
            </div>

            <!-- PRZYCISKI FUNKCJONALNE (dla profilu) -->
            <div class="results-actions glass-box">
              <div class="action-row primary-actions">
                <button type="button" id="download-pdf-btn-profile" class="action-btn primary">
                  <i class="fas fa-file-pdf"></i> Pobierz raport PDF
                </button>
              </div>

              <div class="action-row secondary-actions">
                <button class="action-btn secondary" onclick="goBackToForm()">
                  <i class="fas fa-arrow-left"></i> Wr√≥ƒá do formularza
                </button>
                <button class="action-btn tertiary" onclick="startNewCalculation()">
                  <i class="fas fa-calculator"></i> Nowe obliczenie
                </button>
              </div>
            </div>
          </div>

          <!-- Ekspercka stopka -->
          <div class="expert-footer">
            <i class="fas fa-user-hard-hat"></i> Analiza opracowana przez system
            <strong>TOP-INSTAL</strong>
            <span>Inteligentny algorytm obliczeniowy<br />zgodno≈õƒá z PN-B 02025 i PN-EN 832</span>
          </div>
        </section>
      </form>

      <!-- FINAL PREMIUM AI-COACH DOCK -->
      <div id="ai-coach-dock" aria-live="polite">
        <div class="ai-coach-dock__content">
          <span id="ai-coach-icon" class="ai-coach-dock__icon" aria-label="Pomoc doradcy">
            <svg id="ai-icon-svg" viewBox="0 0 20 20" fill="none" width="22" height="22">
              <circle cx="10" cy="10" r="9" stroke="#d4a574" stroke-width="2" />
              <path d="M10 13v.01" stroke="#d4a574" stroke-width="2" stroke-linecap="round" />
              <path
                d="M10 7a2 2 0 0 1 2 2c0 .828-.895 1.464-1.435 1.947C10.166 11.256 10 12 10 12"
                stroke="#4a5662"
                stroke-width="1.5"
                stroke-linecap="round"
              />
            </svg>
            <span id="ai-coach-loader" class="ai-coach-dock__loader" hidden>
              <svg viewBox="0 0 40 40" width="22" height="22">
                <circle
                  cx="20"
                  cy="20"
                  r="16"
                  stroke="#d4a574"
                  stroke-width="3"
                  fill="none"
                  opacity="0.17"
                />
                <circle
                  cx="20"
                  cy="20"
                  r="16"
                  stroke="#d4a574"
                  stroke-width="3"
                  fill="none"
                  stroke-dasharray="100"
                  stroke-dashoffset="75"
                  stroke-linecap="round"
                >
                  <animateTransform
                    attributeName="transform"
                    type="rotate"
                    values="0 20 20;360 20 20"
                    dur="1s"
                    repeatCount="indefinite"
                  />
                </circle>
              </svg>
            </span>
          </span>
          <span id="ai-coach-dock-text" class="ai-coach-dock__text"
            >Masz wƒÖtpliwo≈õci? Zapytaj doradcƒô</span
          >
          <button
            id="ai-coach-pause"
            class="ai-coach-dock__btn"
            aria-label="Wstrzymaj pomoc"
            title="Wstrzymaj pomoc"
          >
            ‚è∏Ô∏è
          </button>
          <button
            id="ai-coach-resume"
            class="ai-coach-dock__btn"
            aria-label="Wzn√≥w pomoc"
            title="Wzn√≥w pomoc"
            hidden
          >
            ‚ñ∂Ô∏è
          </button>
        </div>
      </div>

      <div id="ai-coach-panel" class="ai-coach-panel" hidden>
        <div class="ai-coach-panel__header">
          <strong>Masz wƒÖtpliwo≈õci?</strong>
          <button type="button" class="ai-coach-panel__close" aria-label="Zamknij pomoc">√ó</button>
        </div>
        <p id="ai-coach-panel-context" class="ai-coach-panel__context"></p>
        <p class="ai-coach-panel__text">
          Wyja≈õniƒô, jak dobraƒá ten element maszynowni i podpowiem najbezpieczniejszƒÖ opcjƒô zgodnƒÖ z
          wytycznymi serwisowymi producenta.
        </p>
        <button type="button" id="ai-coach-apply-recommendation" class="action-btn primary">
          Wybierz rekomendacjƒô
        </button>
      </div>
    </div>

    <div class="brand-content">
      <img
        src="https://topinstal.com.pl/pictures/www-mobile.png"
        alt="TOP-INSTAL"
        class="brand-logo"
        loading="lazy"
      />
      <div class="brand-text">
        <p><strong>Autoryzowany partner Panasonic i Mitsubishi Electric</strong></p>
        <p>Dobieramy technologie tak, by≈õ mia≈Ç spok√≥j i komfort przez wiele lat.</p>
      </div>
    </div>

    <!-- ZEWNƒòTRZNE BIBLIOTEKI -->
    <script
      src="../libraries/html2pdf.bundle.min.js"
      onload="console.log('‚úÖ Skrypt html2pdf za≈Çadowany pomy≈õlnie'); window.html2pdfLoaded = true;"
      onerror="console.error('‚ùå B≈ÇƒÖd ≈Çadowania skryptu html2pdf'); window.html2pdfLoadError = true;"
    ></script>
    <script
      src="../libraries/html2canvas.min.js"
      onload="console.log('‚úÖ Skrypt html2canvas za≈Çadowany');"
      onerror="console.error('‚ùå B≈ÇƒÖd ≈Çadowania html2canvas');"
    ></script>
    <script
      src="../libraries/jspdf.umd.min.js"
      onload="console.log('‚úÖ jsPDF za≈Çadowany');"
      onerror="console.error('‚ùå B≈ÇƒÖd ≈Çadowania jsPDF');"
    ></script>
    <!-- SKRYPTY (KOLEJNO≈öƒÜ JAK W WTYCZCE) -->
    <script src="./js/elementor-fix.js"></script>
    <script src="./js/gdpr-compliance.js"></script>
    <script src="./js/tooltipSystem.js"></script>
    <script src="./js/floorRenderer.js"></script>
    <script src="./js/urlManager.js"></script>
    <script src="./js/state.js"></script>
    <script src="./js/rules.js"></script>
    <script src="./js/visibility.js"></script>
    <script src="./js/enablement.js"></script>
    <script src="./js/render.js"></script>
    <script src="./js/engine.js"></script>
    <script src="./js/progressiveDisclosure.js"></script>
    <script src="./js/formDataProcessor.js"></script>
    <!-- Silnik OZC - fallback dla cieplo.app -->
    <script src="./engine/ozc/ozc-engine.js"></script>
    <script src="./js/downloadPDF.js"></script>
    <script src="./js/pdfGenerator.js"></script>
    <script src="./js/emailSender.js"></script>
    <link rel="stylesheet" href="../konfigurator/configurator.css" />
    <link rel="stylesheet" href="../konfigurator/configurator-v2-flat.css" />
    <script src="../konfigurator/configurator-unified.js"></script>
    <script src="./js/aiWatchers.js"></script>
    <script src="./js/errorHandler.js"></script>
    <script src="./js/onboardingSystem.js"></script>
    <script src="./js/workflowController.js"></script>
    <script src="./js/resultsRenderer.js"></script>
    <script src="./js/tabNavigation.js"></script>
    <script src="./js/calculatorInit.js"></script>
    <script src="./js/ai-coach-dock.js"></script>
    <script>
      // Dynamiczne wczytywanie HTML konfiguratora z osobnego pliku
      (function () {
        function loadConfiguratorView() {
          var container = document.getElementById('configurator-view');
          if (!container) return;

          fetch('../konfigurator/konfigurator.html', { cache: 'no-cache' })
            .then(function (response) {
              if (!response.ok) {
                throw new Error('HTTP ' + response.status);
              }
              return response.text();
            })
            .then(function (html) {
              var parser = new DOMParser();
              var doc = parser.parseFromString(html, 'text/html');
              var remoteView = doc.getElementById('configurator-view') || doc.body;
              if (!remoteView) {
                console.error(
                  '[Configurator] Nie znaleziono #configurator-view w konfigurator.html'
                );
                return;
              }

              console.log('[Configurator] Wstrzykiwanie HTML do #configurator-view');
              container.innerHTML = remoteView.innerHTML;

              // ‚úÖ CZEKAJ a≈º DOM siƒô zaktualizuje (requestAnimationFrame dla pewno≈õci)
              return new Promise(function (resolve) {
                requestAnimationFrame(function () {
                  requestAnimationFrame(function () {
                    resolve();
                  });
                });
              });
            })
            .then(function () {
              // ‚úÖ SPRAWD≈π czy #configurator-app istnieje
              var app = document.getElementById('configurator-app');
              if (!app) {
                console.error(
                  '[Configurator] ‚ùå #configurator-app nie zosta≈Ç znaleziony po wstrzykniƒôciu HTML!'
                );
                var container = document.getElementById('configurator-view');
                if (container) {
                  console.log(
                    '[Configurator] Zawarto≈õƒá container:',
                    container.innerHTML.substring(0, 200)
                  );
                }
                return;
              }

              console.log('[Configurator] ‚úÖ #configurator-app znaleziony');

              // ‚úÖ WYWO≈ÅAJ inicjalizacjƒô z danymi z kalkulatora
              if (typeof window.initNewConfigurator === 'function') {
                console.log('[Configurator] Wywo≈Çujƒô initNewConfigurator() z danymi z kalkulatora');

                var result = window.initNewConfigurator();
                if (result) {
                  console.log('[Configurator] ‚úÖ Konfigurator zainicjalizowany pomy≈õlnie');

                  // ‚úÖ WYPE≈ÅNIJ dane z kalkulatora (je≈õli initNewConfigurator nie robi tego automatycznie)
                  if (typeof window.populateConfiguratorWithCalculatorData === 'function') {
                    setTimeout(function () {
                      window.populateConfiguratorWithCalculatorData();
                    }, 100);
                  }
                } else {
                  console.error('[Configurator] ‚ùå Inicjalizacja zwr√≥ci≈Ça false');
                }
              } else {
                console.warn('[Configurator] ‚ö†Ô∏è window.initNewConfigurator nie jest dostƒôpna!');
                console.log('[Configurator] Czekam na za≈Çadowanie configurator-unified.js...');
                console.log(
                  '[Configurator] Dostƒôpne funkcje window:',
                  Object.keys(window).filter(function (k) {
                    return k.includes('config');
                  })
                );

                // Spr√≥buj ponownie za chwilƒô (je≈õli skrypt siƒô jeszcze ≈Çaduje)
                setTimeout(function () {
                  if (typeof window.initNewConfigurator === 'function') {
                    var result = window.initNewConfigurator();
                    if (
                      result &&
                      typeof window.populateConfiguratorWithCalculatorData === 'function'
                    ) {
                      setTimeout(function () {
                        window.populateConfiguratorWithCalculatorData();
                      }, 100);
                    }
                  }
                }, 500);
              }
            })
            .catch(function (error) {
              console.warn('[Configurator] Nie uda≈Ço siƒô za≈Çadowaƒá konfigurator.html:', error);
            });
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', loadConfiguratorView);
        } else {
          loadConfiguratorView();
        }
      })();
    </script>

    <!-- Collapsible Instruction JavaScript -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const toggle = document.querySelector('.instruction-toggle');
        const content = document.querySelector('.instruction-content');

        if (toggle && content) {
          toggle.addEventListener('click', function () {
            const isExpanded = toggle.getAttribute('aria-expanded') === 'true';

            if (isExpanded) {
              // Zwi≈Ñ
              content.style.display = 'none';
              toggle.setAttribute('aria-expanded', 'false');
            } else {
              // Rozwi≈Ñ
              content.style.display = 'block';
              toggle.setAttribute('aria-expanded', 'true');
            }
          });
        }
      });
    </script>

    <!-- Building Type Cards JavaScript -->
    <script>
      // Globalna funkcja pomocnicza do odczytu warto≈õci building_type z hidden inputa
      window.getBuildingType = function () {
        const hidden = document.getElementById('building_type');
        return hidden ? hidden.value || '' : '';
      };

      // Inicjalizacja kart building_type
      function initBuildingTypeCards() {
        const buildingTypeCards = document.querySelectorAll('.building-type-card');
        const hiddenInput = document.getElementById('building_type');

        if (buildingTypeCards.length === 0 || !hiddenInput) {
          if (!hiddenInput) {
            console.warn('Nie znaleziono ukrytego pola building_type');
          }
          // Je≈õli elementy jeszcze nie istniejƒÖ, spr√≥buj ponownie
          setTimeout(initBuildingTypeCards, 100);
          return;
        }

        function updateCardsFromValue(value) {
          buildingTypeCards.forEach(card => {
            if (card.dataset.value === value) {
              card.classList.add('building-type-card--selected');
            } else {
              card.classList.remove('building-type-card--selected');
            }
          });
        }

        // Funkcja wywo≈ÇujƒÖca wszystkie potrzebne eventy i aktualizacje
        function triggerBuildingTypeChangeInternal(value) {
          // üîí Ochrona: nigdy nie ustawiaj building_type na undefined / null / pusty
          if (value === undefined || value === null) {
            console.warn(
              '[BuildingType] Ignorujƒô pr√≥bƒô ustawienia building_type na undefined/null'
            );
            return;
          }
          if (typeof value === 'string') {
            value = value.trim();
            if (!value) {
              console.warn(
                '[BuildingType] Ignorujƒô pr√≥bƒô ustawienia building_type na pusty string'
              );
              return;
            }
          }

          // Aktualizuj wizualny stan kart
          updateCardsFromValue(value);

          if (hiddenInput.value !== value) {
            hiddenInput.value = value;

            // formEngine automatycznie zareaguje na te eventy
            const changeEventHidden = new Event('change', {
              bubbles: true,
              cancelable: true,
            });
            hiddenInput.dispatchEvent(changeEventHidden);

            const inputEventHidden = new Event('input', {
              bubbles: true,
              cancelable: true,
            });
            hiddenInput.dispatchEvent(inputEventHidden);
          }

          // Utw√≥rz wirtualny event change dla kompatybilno≈õci z istniejƒÖcymi skryptami (np. urlManager.js)
          const changeEvent = new CustomEvent('building_type_change', {
            bubbles: true,
            cancelable: true,
            detail: { value: value },
          });
          document.dispatchEvent(changeEvent);
        }

        // Eksportuj funkcjƒô globalnie dla urlManager.js i innych skrypt√≥w
        window.triggerBuildingTypeChange = triggerBuildingTypeChangeInternal;

        // Obs≈Çuga klikniƒôƒá na karty
        buildingTypeCards.forEach(card => {
          card.addEventListener('click', function () {
            const value = this.dataset.value;
            triggerBuildingTypeChangeInternal(value);
          });

          // Obs≈Çuga klawiatury (Enter, Space)
          card.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              const value = this.dataset.value;
              triggerBuildingTypeChangeInternal(value);
            }
          });
        });

        hiddenInput.addEventListener('change', () => {
          updateCardsFromValue(hiddenInput.value);
        });

        // Zsynchronizuj poczƒÖtkowy stan
        updateCardsFromValue(hiddenInput.value);
      }

      // Inicjalizuj gdy DOM jest gotowy
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initBuildingTypeCards);
      } else {
        // DOM ju≈º za≈Çadowany
        setTimeout(initBuildingTypeCards, 100);
      }

      // Dodatkowo zainicjalizuj po za≈Çadowaniu wszystkich skrypt√≥w
      window.addEventListener('load', function () {
        setTimeout(initBuildingTypeCards, 200);
      });
    </script>

    <!-- Construction Year Checkmark JavaScript -->
    <script>
      function initConstructionYearCheckmark() {
        const constructionYearSelect = document.getElementById('construction_year');
        const wrapper = document.querySelector('.construction-year-wrapper');
        if (!constructionYearSelect || !wrapper) {
          setTimeout(initConstructionYearCheckmark, 100);
          return;
        }

        function updateCheckmark() {
          const value = constructionYearSelect.value;
          // Sprawd≈∫ czy select ma warto≈õƒá
          if (value && value !== '' && value !== '-- Wybierz --') {
            // Stan zako≈Ñczony pojawia siƒô natychmiast po wybraniu opcji
            wrapper.classList.add('has-value');
            wrapper.classList.add('completed');
          } else {
            wrapper.classList.remove('has-value');
            wrapper.classList.remove('completed');
          }
        }

        // Nas≈Çuchuj na zmiany warto≈õci
        constructionYearSelect.addEventListener('change', () => {
          // Zaktualizuj stan (has-value + completed)
          updateCheckmark();
          // Po wybraniu opcji natychmiast ‚Äûwyjd≈∫ z pola‚Äù,
          // ≈ºeby nie da≈Ço siƒô przypadkowo zmieniƒá wyboru scrollowaniem itp.
          constructionYearSelect.blur();
        });
        constructionYearSelect.addEventListener('input', updateCheckmark);

        // Stany focus/blur ‚Äì sterujƒÖ tylko klasƒÖ is-active (completed ustawia updateCheckmark)
        constructionYearSelect.addEventListener('focus', () => {
          wrapper.classList.add('is-active');
        });

        constructionYearSelect.addEventListener('blur', () => {
          wrapper.classList.remove('is-active');
        });

        // Obserwuj zmiany warto≈õci
        const observer = new MutationObserver(function (mutations) {
          mutations.forEach(function (mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'value') {
              updateCheckmark();
            }
          });
          updateCheckmark();
        });
        observer.observe(constructionYearSelect, {
          attributes: true,
          attributeFilter: ['value', 'selectedIndex'],
        });

        // Inicjalizuj stan na starcie
        updateCheckmark();
      }

      // Inicjalizuj gdy DOM jest gotowy
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initConstructionYearCheckmark);
      } else {
        setTimeout(initConstructionYearCheckmark, 100);
      }

      // Dodatkowo zainicjalizuj po za≈Çadowaniu wszystkich skrypt√≥w
      window.addEventListener('load', function () {
        setTimeout(initConstructionYearCheckmark, 200);
      });
    </script>

    <!-- Universal Select Checkmarks JavaScript -->
    <script>
      // Uniwersalny system checkmark√≥w dla wszystkich select√≥w (opr√≥cz construction_year)
      function initSelectCheckmarks() {
        // Znajd≈∫ wszystkie selecty (opr√≥cz construction_year)
        const allSelects = document.querySelectorAll('select.form-select:not(#construction_year)');

        function updateSelectCheckmark(select) {
          const formFieldItem = select.closest('.form-field-item');
          if (!formFieldItem) return;

          const value = select.value;
          const isEmpty =
            !value ||
            value === '' ||
            value === '-- Wybierz --' ||
            value === '-- Wybierz rok budowy --' ||
            value === '-- Wybierz rodzaj budynku --';

          // Dodaj/usu≈Ñ klasƒô w zale≈ºno≈õci od stanu
          if (isEmpty) {
            formFieldItem.classList.remove('has-selected-value');
          } else {
            formFieldItem.classList.add('has-selected-value');
          }
        }

        allSelects.forEach(select => {
          // Nas≈Çuchuj na zmiany
          select.addEventListener('change', function () {
            updateSelectCheckmark(this);
            // Po wybraniu opcji natychmiast ‚Äûwyjd≈∫ z pola‚Äù,
            // ≈ºeby nie da≈Ço siƒô przypadkowo zmieniƒá wyboru scrollowaniem itp.
            this.blur();
          });

          // Focus / blur ‚Äì sterujƒÖ klasƒÖ is-active-select (stan niebieskiej ramki)
          select.addEventListener('focus', function () {
            const formFieldItem = this.closest('.form-field-item');
            if (!formFieldItem) return;
            formFieldItem.classList.add('is-active-select');
          });

          select.addEventListener('blur', function () {
            const formFieldItem = this.closest('.form-field-item');
            if (!formFieldItem) return;
            formFieldItem.classList.remove('is-active-select');
          });

          // Obserwuj zmiany warto≈õci
          const observer = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
              if (mutation.type === 'attributes' && mutation.attributeName === 'value') {
                updateSelectCheckmark(select);
              }
            });
          });
          observer.observe(select, {
            attributes: true,
            attributeFilter: ['value', 'selectedIndex'],
          });

          // Inicjalizuj stan na starcie
          updateSelectCheckmark(select);
        });
      }

      // Inicjalizuj gdy DOM jest gotowy
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSelectCheckmarks);
      } else {
        setTimeout(initSelectCheckmarks, 100);
      }

      // Dodatkowo zainicjalizuj po za≈Çadowaniu wszystkich skrypt√≥w
      window.addEventListener('load', function () {
        setTimeout(initSelectCheckmarks, 200);
      });
    </script>

    <!-- Universal Number Input Checkmarks JavaScript -->
    <script>
      // Uniwersalny system checkmark√≥w dla wszystkich input[type="number"]
      function initNumberInputCheckmarks() {
        // Znajd≈∫ wszystkie inputy numeryczne (opr√≥cz tych w quantity-input i custom-slider)
        const allNumberInputs = document.querySelectorAll(
          'input[type="number"]:not(.quantity-input input):not([data-slider-value])'
        );

        // Warto≈õci domy≈õlne dla p√≥l kt√≥re majƒÖ je w HTML
        const defaultValues = {
          building_length: '10',
          building_width: '5',
        };

        function updateNumberInputCheckmark(input) {
          const formFieldItem = input.closest('.form-field-item');
          if (!formFieldItem) return;

          const value = input.value;
          const fieldName = input.name || input.id;
          const defaultValue = defaultValues[fieldName];

          // Sprawd≈∫ czy warto≈õƒá jest rzeczywi≈õcie wpisana przez u≈ºytkownika
          const isEmpty = !value || value === '' || value === null || value === undefined;
          const isDefaultValue = defaultValue && value === defaultValue;

          // Dodaj/usu≈Ñ klasƒô w zale≈ºno≈õci od stanu
          // Checkmark tylko gdy: nie jest puste, i nie jest warto≈õciƒÖ domy≈õlnƒÖ (je≈õli istnieje)
          // Uwaga: 0 jest wa≈ºnƒÖ warto≈õciƒÖ, wiƒôc pokazujemy checkmark dla 0 je≈õli u≈ºytkownik jƒÖ wpisa≈Ç
          if (isEmpty || isDefaultValue) {
            formFieldItem.classList.remove('has-number-value');
          } else {
            formFieldItem.classList.add('has-number-value');
          }
        }

        allNumberInputs.forEach(input => {
          // Zapisz warto≈õƒá poczƒÖtkowƒÖ dla p√≥l z warto≈õciami domy≈õlnymi
          const fieldName = input.name || input.id;
          if (defaultValues[fieldName] && !input.dataset.originalValue) {
            input.dataset.originalValue = input.value || defaultValues[fieldName];
          }

          // Nas≈Çuchuj na zmiany
          input.addEventListener('input', function () {
            updateNumberInputCheckmark(this);
          });

          input.addEventListener('change', function () {
            updateNumberInputCheckmark(this);
          });

          // Obserwuj zmiany warto≈õci
          const observer = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
              if (mutation.type === 'attributes' && mutation.attributeName === 'value') {
                updateNumberInputCheckmark(input);
              }
            });
          });
          observer.observe(input, {
            attributes: true,
            attributeFilter: ['value'],
          });

          // Inicjalizuj stan na starcie
          updateNumberInputCheckmark(input);
        });
      }

      // Inicjalizuj gdy DOM jest gotowy
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initNumberInputCheckmarks);
      } else {
        setTimeout(initNumberInputCheckmarks, 100);
      }

      // Dodatkowo zainicjalizuj po za≈Çadowaniu wszystkich skrypt√≥w
      window.addEventListener('load', function () {
        setTimeout(initNumberInputCheckmarks, 200);
      });
    </script>

    <!-- Yes/No Cards JavaScript -->
    <script>
      // Uniwersalny system kart Tak/Nie
      function initYesNoCards() {
        const yesNoCards = document.querySelectorAll('.yes-no-card');
        if (yesNoCards.length === 0) {
          setTimeout(initYesNoCards, 100);
          return;
        }

        // Grupuj karty wed≈Çug pola (data-field)
        const cardsByField = {};
        yesNoCards.forEach(card => {
          const fieldName = card.dataset.field;
          if (!cardsByField[fieldName]) {
            cardsByField[fieldName] = [];
          }
          cardsByField[fieldName].push(card);
        });

        // Inicjalizuj ka≈ºdƒÖ grupƒô kart
        Object.keys(cardsByField).forEach(fieldName => {
          const cards = cardsByField[fieldName];
          const hiddenInput = document.getElementById(fieldName);

          if (!hiddenInput) {
            console.warn(`Nie znaleziono inputa dla pola: ${fieldName}`);
            return;
          }

          // Funkcja aktualizujƒÖca stan kart na podstawie inputa
          function updateCardsFromInput() {
            const selectedValue = hiddenInput.value;
            cards.forEach(card => {
              if (card.dataset.value === selectedValue) {
                card.classList.add('yes-no-card--selected');
              } else {
                card.classList.remove('yes-no-card--selected');
              }
            });
          }

          // Funkcja wywo≈ÇujƒÖca wszystkie potrzebne eventy i aktualizacje
          function triggerYesNoChange(value) {
            // Aktualizuj ukryty input
            hiddenInput.value = value;

            // Aktualizuj wizualny stan kart
            updateCardsFromInput();

            // Wywo≈Çaj natywny event change
            const changeEvent = new Event('change', {
              bubbles: true,
              cancelable: true,
            });
            hiddenInput.dispatchEvent(changeEvent);

            // Wywo≈Çaj r√≥wnie≈º input event
            const inputEvent = new Event('input', {
              bubbles: true,
              cancelable: true,
            });
            hiddenInput.dispatchEvent(inputEvent);

            // formEngine automatycznie zareaguje na te eventy
          }

          // Obs≈Çuga klikniƒôƒá na karty
          cards.forEach(card => {
            card.addEventListener('click', function () {
              // Sprawd≈∫ czy karta nie jest disabled
              if (this.classList.contains('yes-no-card--disabled')) {
                return;
              }
              const value = this.dataset.value;
              triggerYesNoChange(value);
            });

            // Obs≈Çuga klawiatury (Enter, Space)
            card.addEventListener('keydown', function (e) {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                // Sprawd≈∫ czy karta nie jest disabled
                if (this.classList.contains('yes-no-card--disabled')) {
                  return;
                }
                const value = this.dataset.value;
                triggerYesNoChange(value);
              }
            });
          });

          // Obs≈Çuga zmian w input (na wypadek, gdyby co≈õ innego zmieni≈Ço warto≈õƒá)
          hiddenInput.addEventListener('change', function () {
            updateCardsFromInput();
          });

          // Inicjalizuj stan na starcie
          updateCardsFromInput();
        });
      }

      // Inicjalizuj gdy DOM jest gotowy
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initYesNoCards);
      } else {
        setTimeout(initYesNoCards, 100);
      }

      // Dodatkowo zainicjalizuj po za≈Çadowaniu wszystkich skrypt√≥w
      window.addEventListener('load', function () {
        setTimeout(initYesNoCards, 200);
      });
    </script>

    <!-- Help-box visibility for hot water usage -->
    <script>
      function updateHotWaterUsageHelpBox() {
        const includeHotWaterInput = document.getElementById('include_hot_water');
        const helpBox = document.getElementById('hotWaterUsageHelpBox');

        if (!includeHotWaterInput || !helpBox) {
          return;
        }

        // Poka≈º help-box tylko gdy CWU = "yes"
        if (includeHotWaterInput.value === 'yes') {
          helpBox.style.display = 'block';
        } else {
          helpBox.style.display = 'none';
        }
      }

      // Inicjalizuj przy za≈Çadowaniu
      function initHotWaterUsageHelpBox() {
        const includeHotWaterInput = document.getElementById('include_hot_water');
        if (!includeHotWaterInput) {
          setTimeout(initHotWaterUsageHelpBox, 100);
          return;
        }

        // Ustaw poczƒÖtkowy stan
        updateHotWaterUsageHelpBox();

        // Nas≈Çuchuj zmian
        includeHotWaterInput.addEventListener('change', updateHotWaterUsageHelpBox);
        includeHotWaterInput.addEventListener('input', updateHotWaterUsageHelpBox);
      }

      // Inicjalizuj gdy DOM jest gotowy
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initHotWaterUsageHelpBox);
      } else {
        setTimeout(initHotWaterUsageHelpBox, 100);
      }

      // Dodatkowo zainicjalizuj po za≈Çadowaniu wszystkich skrypt√≥w
      window.addEventListener('load', function () {
        setTimeout(initHotWaterUsageHelpBox, 200);
      });
    </script>

    <!-- Progress Label Animation JavaScript -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const progressFill = document.getElementById('top-progress-fill');
        const progressLabel = document.querySelector('.form-progress-label');
        const progressPercentage = document.getElementById('progress-percentage');

        if (progressFill && progressLabel && progressPercentage) {
          // Obserwuj zmiany w szeroko≈õci progress-bara
          const observer = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
              if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                const width = progressFill.style.width;
                const widthValue = parseFloat(width);

                // Aktualizuj procent
                progressPercentage.textContent = Math.round(widthValue) + '%';

                if (widthValue > 0) {
                  // Przesu≈Ñ napis razem z paskiem (maksymalnie 20px w prawo)
                  const translateX = Math.min(widthValue * 0.2, 20);
                  progressLabel.style.transform = `translateX(${translateX}px)`;
                  progressLabel.style.transition = 'transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                } else {
                  // Reset pozycji gdy progress = 0
                  progressLabel.style.transform = 'translateX(0)';
                }
              }
            });
          });

          // Rozpocznij obserwacjƒô
          observer.observe(progressFill, {
            attributes: true,
            attributeFilter: ['style'],
          });
        }
      });
    </script>

    <!-- Helper function for unlocking fields -->
    <script>
      // Uniwersalna funkcja do odblokowywania p√≥l (u≈ºywana przez slidery)
      window.unlockFields = function (fieldNames) {
        if (!Array.isArray(fieldNames)) return;

        fieldNames.forEach(fieldName => {
          // Znajd≈∫ elementy pola
          let elements;
          try {
            if (fieldName.includes('[')) {
              elements = document.querySelectorAll(`[name="${fieldName}"]`);
            } else {
              elements = document.querySelectorAll(`[name="${fieldName}"], #${fieldName}`);
            }
          } catch (e) {
            console.warn('[unlockFields] B≈ÇƒÖd selektora dla:', fieldName, e);
            return;
          }

          elements.forEach(el => {
            el.classList.remove('field-disabled');

            const container =
              el.closest('.form-field-item') ||
              el.closest('.form-field__radio-group') ||
              el.closest('.option-cards') ||
              el.closest('.form-field');
            if (container) {
              container.classList.remove('field-disabled');
            }
          });

          // Odblokuj karty Tak/Nie je≈õli sƒÖ
          const yesNoCards = document.querySelectorAll(`.yes-no-card[data-field="${fieldName}"]`);
          yesNoCards.forEach(card => {
            card.classList.remove('yes-no-card--disabled');
          });
        });
      };
    </script>

    <!-- Custom Balcony Slider JavaScript -->
    <script>
      (function () {
        let currentValue = 1;
        const MIN = 1;
        const MAX = 6;

        document.addEventListener('DOMContentLoaded', function () {
          const track = document.getElementById('customSliderTrack');
          const thumb = document.getElementById('customSliderThumb');
          const bubble = document.getElementById('customBalconyBubble');
          const hiddenInput = document.getElementById('number_balcony_doors');
          const container = track ? track.closest('.custom-slider-container') : null;
          const ticks = container ? container.querySelectorAll('.custom-slider-ticks .tick') : [];

          if (!track || !thumb || !bubble || !hiddenInput) {
            console.warn('[Slider Balkon√≥w] Brak wymaganych element√≥w:', {
              track: !!track,
              thumb: !!thumb,
              bubble: !!bubble,
              hiddenInput: !!hiddenInput,
            });
            return;
          }

          console.log('[Slider Balkon√≥w] Inicjalizacja rozpoczƒôta');

          // Funkcja do ustawienia warto≈õci i pozycji
          function setValue(value) {
            // Ogranicz warto≈õƒá do zakresu MIN-MAX
            value = Math.max(MIN, Math.min(MAX, Math.round(value)));
            currentValue = value;

            console.log('[Slider Balkon√≥w] setValue:', value);

            // Oblicz pozycjƒô w procentach (0% dla MIN, 100% dla MAX)
            const percent = ((value - MIN) / (MAX - MIN)) * 100;

            // Ustaw pozycjƒô thumba i bƒÖbelka
            thumb.style.left = percent + '%';
            bubble.style.left = percent + '%';

            // Aktualizuj tekst w bƒÖbelku i hidden input
            bubble.textContent = value;
            hiddenInput.value = value;

            console.log('[Slider Balkon√≥w] Warto≈õƒá inputa ustawiona na:', hiddenInput.value);

            const sliderInputEvent = new Event('input', { bubbles: true, cancelable: true });
            hiddenInput.dispatchEvent(sliderInputEvent);
            console.log('[Slider Balkon√≥w] Event input wywo≈Çany');

            // Odblokuj pola poni≈ºej slidera (bez wywo≈Çywania recompute)
            if (typeof window.unlockFields === 'function') {
              window.unlockFields([
                'building_floors',
                'building_roof',
                'building_heated_floors[]',
                'attic_access',
                'floor_height',
                'garage_type',
              ]);
            }

            // Zaznacz aktywny tick
            ticks.forEach(tick => {
              if (parseInt(tick.dataset.value) === value) {
                tick.classList.add('active');
              } else {
                tick.classList.remove('active');
              }
            });
          }

          // Funkcja do obliczenia warto≈õci na podstawie pozycji klikniƒôcia
          function getValueFromPosition(clientX) {
            const rect = track.getBoundingClientRect();
            const x = clientX - rect.left;
            const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
            const value = Math.round((percent / 100) * (MAX - MIN) + MIN);
            return value;
          }

          // Obs≈Çuga przeciƒÖgania thumba
          let isDragging = false;

          thumb.addEventListener('mousedown', function (e) {
            isDragging = true;
            e.preventDefault();
          });

          document.addEventListener('mousemove', function (e) {
            if (!isDragging) return;
            const value = getValueFromPosition(e.clientX);
            setValue(value);
          });

          document.addEventListener('mouseup', function () {
            if (isDragging) {
              isDragging = false;
            }
          });

          // Obs≈Çuga klikniƒôcia na track
          track.addEventListener('click', function (e) {
            if (e.target === thumb) return;
            const value = getValueFromPosition(e.clientX);
            setValue(value);
          });

          // Obs≈Çuga klikniƒôcia na ticki
          ticks.forEach(tick => {
            tick.addEventListener('click', function () {
              const value = parseInt(this.dataset.value);
              setValue(value);
            });
          });

          // Touch support dla urzƒÖdze≈Ñ mobilnych
          thumb.addEventListener('touchstart', function (e) {
            isDragging = true;
            e.preventDefault();
          });

          document.addEventListener('touchmove', function (e) {
            if (!isDragging) return;
            const touch = e.touches[0];
            const value = getValueFromPosition(touch.clientX);
            setValue(value);
          });

          document.addEventListener('touchend', function () {
            if (isDragging) {
              isDragging = false;
            }
          });

          // Inicjalizacja - ustaw warto≈õƒá 1 na starcie
          setValue(1);
        });
      })();
    </script>

    <!-- Custom Windows Slider JavaScript -->
    <script>
      (function () {
        let currentValue = 14;
        const MIN = 4;
        const MAX = 24;

        document.addEventListener('DOMContentLoaded', function () {
          const track = document.getElementById('customWindowsTrack');
          const thumb = document.getElementById('customWindowsThumb');
          const bubble = document.getElementById('customWindowsBubble');
          const hiddenInput = document.getElementById('number_windows');
          const container = track.closest('.custom-slider-container');
          const ticks = container ? container.querySelectorAll('.custom-slider-ticks .tick') : [];

          if (!track || !thumb || !bubble || !hiddenInput) return;

          function setValue(value) {
            value = Math.max(MIN, Math.min(MAX, Math.round(value)));
            currentValue = value;
            const percent = ((value - MIN) / (MAX - MIN)) * 100;
            thumb.style.left = percent + '%';
            bubble.style.left = percent + '%';
            bubble.textContent = value;
            hiddenInput.value = value;
            const sliderInputEvent = new Event('input', { bubbles: true, cancelable: true });
            hiddenInput.dispatchEvent(sliderInputEvent);

            // Odblokuj pola poni≈ºej slidera (je≈õli sƒÖ zdefiniowane)
            const unlockMap = {
              number_windows: ['number_huge_windows'],
              number_huge_windows: ['doors_type'],
              wall_size: [
                'has_secondary_wall_material',
                'has_external_isolation',
                'internal_wall_isolation[material]',
              ],
              internal_wall_isolation_size: [
                'has_secondary_wall_material',
                'has_external_isolation',
              ],
              top_isolation_size: ['bottom_isolation'],
              indoor_temperature: ['ventilation_type'],
              hot_water_persons: ['hot_water_usage'],
            };

            if (
              hiddenInput &&
              hiddenInput.id &&
              unlockMap[hiddenInput.id] &&
              typeof window.unlockFields === 'function'
            ) {
              window.unlockFields(unlockMap[hiddenInput.id]);
            }

            ticks.forEach(tick => {
              if (parseInt(tick.dataset.value) === value) {
                tick.classList.add('active');
              } else {
                tick.classList.remove('active');
              }
            });
          }

          function getValueFromPosition(clientX) {
            const rect = track.getBoundingClientRect();
            const x = clientX - rect.left;
            const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
            const value = Math.round((percent / 100) * (MAX - MIN) + MIN);
            return value;
          }

          let isDragging = false;

          thumb.addEventListener('mousedown', function (e) {
            isDragging = true;
            e.preventDefault();
          });

          document.addEventListener('mousemove', function (e) {
            if (!isDragging) return;
            const value = getValueFromPosition(e.clientX);
            setValue(value);
          });

          document.addEventListener('mouseup', function () {
            if (isDragging) isDragging = false;
          });

          track.addEventListener('click', function (e) {
            if (e.target === thumb) return;
            const value = getValueFromPosition(e.clientX);
            setValue(value);
          });

          ticks.forEach(tick => {
            tick.addEventListener('click', function () {
              const value = parseInt(this.dataset.value);
              setValue(value);
            });
          });

          thumb.addEventListener('touchstart', function (e) {
            isDragging = true;
            e.preventDefault();
          });

          document.addEventListener('touchmove', function (e) {
            if (!isDragging) return;
            const touch = e.touches[0];
            const value = getValueFromPosition(touch.clientX);
            setValue(value);
          });

          document.addEventListener('touchend', function () {
            if (isDragging) isDragging = false;
          });

          setValue(14);
        });
      })();
    </script>

    <!-- Custom Doors Slider JavaScript -->
    <script>
      (function () {
        let currentValue = 1;
        const MIN = 1;
        const MAX = 4;

        document.addEventListener('DOMContentLoaded', function () {
          const track = document.getElementById('customDoorsTrack');
          const thumb = document.getElementById('customDoorsThumb');
          const bubble = document.getElementById('customDoorsBubble');
          const hiddenInput = document.getElementById('number_doors');
          const container = track.closest('.custom-slider-container');
          const ticks = container ? container.querySelectorAll('.custom-slider-ticks .tick') : [];

          if (!track || !thumb || !bubble || !hiddenInput) return;

          function setValue(value) {
            value = Math.max(MIN, Math.min(MAX, Math.round(value)));
            currentValue = value;
            const percent = ((value - MIN) / (MAX - MIN)) * 100;
            thumb.style.left = percent + '%';
            bubble.style.left = percent + '%';
            bubble.textContent = value;
            hiddenInput.value = value;
            const sliderInputEvent = new Event('input', { bubbles: true, cancelable: true });
            hiddenInput.dispatchEvent(sliderInputEvent);

            // Odblokuj pola poni≈ºej slidera (je≈õli sƒÖ zdefiniowane)
            const unlockMap = {
              number_windows: ['number_huge_windows'],
              number_huge_windows: ['doors_type'],
              wall_size: [
                'has_secondary_wall_material',
                'has_external_isolation',
                'internal_wall_isolation[material]',
              ],
              internal_wall_isolation_size: [
                'has_secondary_wall_material',
                'has_external_isolation',
              ],
              top_isolation_size: ['bottom_isolation'],
              indoor_temperature: ['ventilation_type'],
              hot_water_persons: ['hot_water_usage'],
            };

            if (
              hiddenInput &&
              hiddenInput.id &&
              unlockMap[hiddenInput.id] &&
              typeof window.unlockFields === 'function'
            ) {
              window.unlockFields(unlockMap[hiddenInput.id]);
            }

            ticks.forEach(tick => {
              if (parseInt(tick.dataset.value) === value) {
                tick.classList.add('active');
              } else {
                tick.classList.remove('active');
              }
            });
          }

          function getValueFromPosition(clientX) {
            const rect = track.getBoundingClientRect();
            const x = clientX - rect.left;
            const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
            const value = Math.round((percent / 100) * (MAX - MIN) + MIN);
            return value;
          }

          let isDragging = false;

          thumb.addEventListener('mousedown', function (e) {
            isDragging = true;
            e.preventDefault();
          });

          document.addEventListener('mousemove', function (e) {
            if (!isDragging) return;
            const value = getValueFromPosition(e.clientX);
            setValue(value);
          });

          document.addEventListener('mouseup', function () {
            if (isDragging) isDragging = false;
          });

          track.addEventListener('click', function (e) {
            if (e.target === thumb) return;
            const value = getValueFromPosition(e.clientX);
            setValue(value);
          });

          ticks.forEach(tick => {
            tick.addEventListener('click', function () {
              const value = parseInt(this.dataset.value);
              setValue(value);
            });
          });

          thumb.addEventListener('touchstart', function (e) {
            isDragging = true;
            e.preventDefault();
          });

          document.addEventListener('touchmove', function (e) {
            if (!isDragging) return;
            const touch = e.touches[0];
            const value = getValueFromPosition(touch.clientX);
            setValue(value);
          });

          document.addEventListener('touchend', function () {
            if (isDragging) isDragging = false;
          });

          setValue(1);
        });
      })();
    </script>

    <!-- Custom Huge Windows Slider JavaScript -->
    <script>
      (function () {
        let currentValue = 0;
        const MIN = 0;
        const MAX = 5;

        document.addEventListener('DOMContentLoaded', function () {
          const track = document.getElementById('customHugeWindowsTrack');
          const thumb = document.getElementById('customHugeWindowsThumb');
          const bubble = document.getElementById('customHugeWindowsBubble');
          const hiddenInput = document.getElementById('number_huge_windows');
          const container = track.closest('.custom-slider-container');
          const ticks = container ? container.querySelectorAll('.custom-slider-ticks .tick') : [];

          if (!track || !thumb || !bubble || !hiddenInput) return;

          function setValue(value) {
            value = Math.max(MIN, Math.min(MAX, Math.round(value)));
            currentValue = value;
            const percent = ((value - MIN) / (MAX - MIN)) * 100;
            thumb.style.left = percent + '%';
            bubble.style.left = percent + '%';
            bubble.textContent = value;
            hiddenInput.value = value;
            const sliderInputEvent = new Event('input', { bubbles: true, cancelable: true });
            hiddenInput.dispatchEvent(sliderInputEvent);

            // Odblokuj pola poni≈ºej slidera (je≈õli sƒÖ zdefiniowane)
            const unlockMap = {
              number_windows: ['number_huge_windows'],
              number_huge_windows: ['doors_type'],
              wall_size: [
                'has_secondary_wall_material',
                'has_external_isolation',
                'internal_wall_isolation[material]',
              ],
              internal_wall_isolation_size: [
                'has_secondary_wall_material',
                'has_external_isolation',
              ],
              top_isolation_size: ['bottom_isolation'],
              indoor_temperature: ['ventilation_type'],
              hot_water_persons: ['hot_water_usage'],
            };

            if (
              hiddenInput &&
              hiddenInput.id &&
              unlockMap[hiddenInput.id] &&
              typeof window.unlockFields === 'function'
            ) {
              window.unlockFields(unlockMap[hiddenInput.id]);
            }

            ticks.forEach(tick => {
              if (parseInt(tick.dataset.value) === value) {
                tick.classList.add('active');
              } else {
                tick.classList.remove('active');
              }
            });
          }

          function getValueFromPosition(clientX) {
            const rect = track.getBoundingClientRect();
            const x = clientX - rect.left;
            const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
            const value = Math.round((percent / 100) * (MAX - MIN) + MIN);
            return value;
          }

          let isDragging = false;

          thumb.addEventListener('mousedown', function (e) {
            isDragging = true;
            e.preventDefault();
          });

          document.addEventListener('mousemove', function (e) {
            if (!isDragging) return;
            const value = getValueFromPosition(e.clientX);
            setValue(value);
          });

          document.addEventListener('mouseup', function () {
            if (isDragging) isDragging = false;
          });

          track.addEventListener('click', function (e) {
            if (e.target === thumb) return;
            const value = getValueFromPosition(e.clientX);
            setValue(value);
          });

          ticks.forEach(tick => {
            tick.addEventListener('click', function () {
              const value = parseInt(this.dataset.value);
              setValue(value);
            });
          });

          thumb.addEventListener('touchstart', function (e) {
            isDragging = true;
            e.preventDefault();
          });

          document.addEventListener('touchmove', function (e) {
            if (!isDragging) return;
            const touch = e.touches[0];
            const value = getValueFromPosition(touch.clientX);
            setValue(value);
          });

          document.addEventListener('touchend', function () {
            if (isDragging) isDragging = false;
          });

          setValue(0);
        });
      })();
    </script>

    <!-- Custom Persons Slider JavaScript (niestandardowe warto≈õci) -->
    <script>
      (function () {
        // Mapowanie pozycji slidera na warto≈õci formularza
        const VALUES = [2, 3, 4, 6, 8]; // Odpowiada pozycjom 0, 1, 2, 3, 4
        const LABELS = ['1-2', '3', '4', '5-6', '7+'];
        let currentPosition = 2; // Domy≈õlnie pozycja 2 (warto≈õƒá 4)

        document.addEventListener('DOMContentLoaded', function () {
          const track = document.getElementById('customPersonsTrack');
          const thumb = document.getElementById('customPersonsThumb');
          const bubble = document.getElementById('customPersonsBubble');
          const hiddenInput = document.getElementById('hot_water_persons');
          const container = track.closest('.custom-slider-container');
          const ticks = container ? container.querySelectorAll('.custom-slider-ticks .tick') : [];

          if (!track || !thumb || !bubble || !hiddenInput) return;

          function setValue(position) {
            position = Math.max(0, Math.min(VALUES.length - 1, Math.round(position)));
            currentPosition = position;

            const percent = (position / (VALUES.length - 1)) * 100;
            thumb.style.left = percent + '%';
            bubble.style.left = percent + '%';

            const actualValue = VALUES[position];
            const label = LABELS[position];

            bubble.textContent = label;
            hiddenInput.value = actualValue;

            ticks.forEach((tick, index) => {
              if (index === position) {
                tick.classList.add('active');
              } else {
                tick.classList.remove('active');
              }
            });
          }

          function getPositionFromClick(clientX) {
            const rect = track.getBoundingClientRect();
            const x = clientX - rect.left;
            const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
            const position = Math.round((percent / 100) * (VALUES.length - 1));
            return position;
          }

          let isDragging = false;

          thumb.addEventListener('mousedown', function (e) {
            isDragging = true;
            e.preventDefault();
          });

          document.addEventListener('mousemove', function (e) {
            if (!isDragging) return;
            const position = getPositionFromClick(e.clientX);
            setValue(position);
          });

          document.addEventListener('mouseup', function () {
            if (isDragging) isDragging = false;
          });

          track.addEventListener('click', function (e) {
            if (e.target === thumb) return;
            const position = getPositionFromClick(e.clientX);
            setValue(position);
          });

          ticks.forEach((tick, index) => {
            tick.addEventListener('click', function () {
              setValue(index);
            });
          });

          thumb.addEventListener('touchstart', function (e) {
            isDragging = true;
            e.preventDefault();
          });

          document.addEventListener('touchmove', function (e) {
            if (!isDragging) return;
            const touch = e.touches[0];
            const position = getPositionFromClick(touch.clientX);
            setValue(position);
          });

          document.addEventListener('touchend', function () {
            if (isDragging) isDragging = false;
          });

          setValue(2); // Domy≈õlnie pozycja 2 (4 osoby)
        });
      })();
    </script>

    <!-- Custom Wall Insulation Slider JavaScript -->
    <script>
      (function () {
        const MIN = 5,
          MAX = 35,
          STEP = 5,
          DEFAULT = 15;

        document.addEventListener('DOMContentLoaded', function () {
          const track = document.getElementById('customWallInsulationTrack');
          const thumb = document.getElementById('customWallInsulationThumb');
          const bubble = document.getElementById('customWallInsulationBubble');
          const hiddenInput = document.getElementById('external_wall_isolation_size');
          const container = track ? track.closest('.custom-slider-container') : null;
          const ticks = container ? container.querySelectorAll('.custom-slider-ticks .tick') : [];

          if (!track || !thumb || !bubble || !hiddenInput) return;

          function setValue(value) {
            value = Math.max(MIN, Math.min(MAX, Math.round(value / STEP) * STEP));
            const percent = ((value - MIN) / (MAX - MIN)) * 100;
            thumb.style.left = percent + '%';
            bubble.style.left = percent + '%';
            bubble.textContent = value;
            hiddenInput.value = value;
            const sliderInputEvent = new Event('input', { bubbles: true, cancelable: true });
            hiddenInput.dispatchEvent(sliderInputEvent);
            // formEngine automatycznie obs≈Çu≈ºy event input (updateFieldState ‚Üí recompute)

            ticks.forEach(tick =>
              tick.classList.toggle('active', parseInt(tick.dataset.value) === value)
            );
          }

          function getValueFromPosition(clientX) {
            const rect = track.getBoundingClientRect();
            const percent = Math.max(0, Math.min(100, ((clientX - rect.left) / rect.width) * 100));
            return Math.round((percent / 100) * (MAX - MIN) + MIN);
          }

          let isDragging = false;
          thumb.addEventListener('mousedown', e => {
            isDragging = true;
            e.preventDefault();
          });
          document.addEventListener(
            'mousemove',
            e => isDragging && setValue(getValueFromPosition(e.clientX))
          );
          document.addEventListener('mouseup', () => (isDragging = false));
          track.addEventListener(
            'click',
            e => e.target !== thumb && setValue(getValueFromPosition(e.clientX))
          );
          ticks.forEach(tick =>
            tick.addEventListener('click', () => setValue(parseInt(tick.dataset.value)))
          );
          thumb.addEventListener('touchstart', e => {
            isDragging = true;
            e.preventDefault();
          });
          document.addEventListener(
            'touchmove',
            e => isDragging && setValue(getValueFromPosition(e.touches[0].clientX))
          );
          document.addEventListener('touchend', () => (isDragging = false));
          setValue(DEFAULT);
        });
      })();
    </script>

    <!-- Custom Roof Insulation Slider JavaScript -->
    <script>
      (function () {
        const MIN = 10,
          MAX = 45,
          STEP = 5,
          DEFAULT = 30;

        document.addEventListener('DOMContentLoaded', function () {
          const track = document.getElementById('customRoofInsulationTrack');
          const thumb = document.getElementById('customRoofInsulationThumb');
          const bubble = document.getElementById('customRoofInsulationBubble');
          const hiddenInput = document.getElementById('top_isolation_size');
          const container = track ? track.closest('.custom-slider-container') : null;
          const ticks = container ? container.querySelectorAll('.custom-slider-ticks .tick') : [];

          if (!track || !thumb || !bubble || !hiddenInput) return;

          function setValue(value) {
            value = Math.max(MIN, Math.min(MAX, Math.round(value / STEP) * STEP));
            const percent = ((value - MIN) / (MAX - MIN)) * 100;
            thumb.style.left = percent + '%';
            bubble.style.left = percent + '%';
            bubble.textContent = value;
            hiddenInput.value = value;
            const sliderInputEvent = new Event('input', { bubbles: true, cancelable: true });
            hiddenInput.dispatchEvent(sliderInputEvent);
            // formEngine automatycznie obs≈Çu≈ºy event input (updateFieldState ‚Üí recompute)

            ticks.forEach(tick =>
              tick.classList.toggle('active', parseInt(tick.dataset.value) === value)
            );
          }

          function getValueFromPosition(clientX) {
            const rect = track.getBoundingClientRect();
            const percent = Math.max(0, Math.min(100, ((clientX - rect.left) / rect.width) * 100));
            return Math.round((percent / 100) * (MAX - MIN) + MIN);
          }

          let isDragging = false;
          thumb.addEventListener('mousedown', e => {
            isDragging = true;
            e.preventDefault();
          });
          document.addEventListener(
            'mousemove',
            e => isDragging && setValue(getValueFromPosition(e.clientX))
          );
          document.addEventListener('mouseup', () => (isDragging = false));
          track.addEventListener(
            'click',
            e => e.target !== thumb && setValue(getValueFromPosition(e.clientX))
          );
          ticks.forEach(tick =>
            tick.addEventListener('click', () => setValue(parseInt(tick.dataset.value)))
          );
          thumb.addEventListener('touchstart', e => {
            isDragging = true;
            e.preventDefault();
          });
          document.addEventListener(
            'touchmove',
            e => isDragging && setValue(getValueFromPosition(e.touches[0].clientX))
          );
          document.addEventListener('touchend', () => (isDragging = false));
          setValue(DEFAULT);
        });
      })();
    </script>

    <!-- Custom Floor Insulation Slider JavaScript -->
    <script>
      (function () {
        const MIN = 5,
          MAX = 30,
          STEP = 5,
          DEFAULT = 15;

        document.addEventListener('DOMContentLoaded', function () {
          const track = document.getElementById('customFloorInsulationTrack');
          const thumb = document.getElementById('customFloorInsulationThumb');
          const bubble = document.getElementById('customFloorInsulationBubble');
          const hiddenInput = document.getElementById('bottom_isolation_size');
          const container = track ? track.closest('.custom-slider-container') : null;
          const ticks = container ? container.querySelectorAll('.custom-slider-ticks .tick') : [];

          if (!track || !thumb || !bubble || !hiddenInput) return;

          function setValue(value) {
            value = Math.max(MIN, Math.min(MAX, Math.round(value / STEP) * STEP));
            const percent = ((value - MIN) / (MAX - MIN)) * 100;
            thumb.style.left = percent + '%';
            bubble.style.left = percent + '%';
            bubble.textContent = value;
            hiddenInput.value = value;
            const sliderInputEvent = new Event('input', { bubbles: true, cancelable: true });
            hiddenInput.dispatchEvent(sliderInputEvent);
            // formEngine automatycznie obs≈Çu≈ºy event input (updateFieldState ‚Üí recompute)

            ticks.forEach(tick =>
              tick.classList.toggle('active', parseInt(tick.dataset.value) === value)
            );
          }

          function getValueFromPosition(clientX) {
            const rect = track.getBoundingClientRect();
            const percent = Math.max(0, Math.min(100, ((clientX - rect.left) / rect.width) * 100));
            return Math.round((percent / 100) * (MAX - MIN) + MIN);
          }

          let isDragging = false;
          thumb.addEventListener('mousedown', e => {
            isDragging = true;
            e.preventDefault();
          });
          document.addEventListener(
            'mousemove',
            e => isDragging && setValue(getValueFromPosition(e.clientX))
          );
          document.addEventListener('mouseup', () => (isDragging = false));
          track.addEventListener(
            'click',
            e => e.target !== thumb && setValue(getValueFromPosition(e.clientX))
          );
          ticks.forEach(tick =>
            tick.addEventListener('click', () => setValue(parseInt(tick.dataset.value)))
          );
          thumb.addEventListener('touchstart', e => {
            isDragging = true;
            e.preventDefault();
          });
          document.addEventListener(
            'touchmove',
            e => isDragging && setValue(getValueFromPosition(e.touches[0].clientX))
          );
          document.addEventListener('touchend', () => (isDragging = false));
          setValue(DEFAULT);
        });
      })();
    </script>

    <!-- Custom Internal Wall Insulation Slider JavaScript -->
    <script>
      (function () {
        const MIN = 5,
          MAX = 30,
          STEP = 5,
          DEFAULT = 5;

        document.addEventListener('DOMContentLoaded', function () {
          const track = document.getElementById('customInternalInsulationTrack');
          const thumb = document.getElementById('customInternalInsulationThumb');
          const bubble = document.getElementById('customInternalInsulationBubble');
          const hiddenInput = document.getElementById('internal_wall_isolation_size');
          const container = track ? track.closest('.custom-slider-container') : null;
          const ticks = container ? container.querySelectorAll('.custom-slider-ticks .tick') : [];

          if (!track || !thumb || !bubble || !hiddenInput) return;

          function setValue(value) {
            value = Math.max(MIN, Math.min(MAX, Math.round(value / STEP) * STEP));
            const percent = ((value - MIN) / (MAX - MIN)) * 100;
            thumb.style.left = percent + '%';
            bubble.style.left = percent + '%';
            bubble.textContent = value;
            hiddenInput.value = value;
            const sliderInputEvent = new Event('input', { bubbles: true, cancelable: true });
            hiddenInput.dispatchEvent(sliderInputEvent);
            // formEngine automatycznie obs≈Çu≈ºy event input (updateFieldState ‚Üí recompute)

            ticks.forEach(tick =>
              tick.classList.toggle('active', parseInt(tick.dataset.value) === value)
            );
          }

          function getValueFromPosition(clientX) {
            const rect = track.getBoundingClientRect();
            const percent = Math.max(0, Math.min(100, ((clientX - rect.left) / rect.width) * 100));
            return Math.round((percent / 100) * (MAX - MIN) + MIN);
          }

          let isDragging = false;
          thumb.addEventListener('mousedown', e => {
            isDragging = true;
            e.preventDefault();
          });
          document.addEventListener(
            'mousemove',
            e => isDragging && setValue(getValueFromPosition(e.clientX))
          );
          document.addEventListener('mouseup', () => (isDragging = false));
          track.addEventListener(
            'click',
            e => e.target !== thumb && setValue(getValueFromPosition(e.clientX))
          );
          ticks.forEach(tick =>
            tick.addEventListener('click', () => setValue(parseInt(tick.dataset.value)))
          );
          thumb.addEventListener('touchstart', e => {
            isDragging = true;
            e.preventDefault();
          });
          document.addEventListener(
            'touchmove',
            e => isDragging && setValue(getValueFromPosition(e.touches[0].clientX))
          );
          document.addEventListener('touchend', () => (isDragging = false));
          setValue(DEFAULT);
        });
      })();
    </script>

    <!-- Custom Temperature Slider JavaScript -->
    <script>
      (function () {
        const MIN = 17,
          MAX = 25,
          DEFAULT = 21;

        document.addEventListener('DOMContentLoaded', function () {
          const track = document.getElementById('customTemperatureTrack');
          const thumb = document.getElementById('customTemperatureThumb');
          const bubble = document.getElementById('customTemperatureBubble');
          const hiddenInput = document.getElementById('indoor_temperature');
          const container = track ? track.closest('.custom-slider-container') : null;
          const ticks = container ? container.querySelectorAll('.custom-slider-ticks .tick') : [];

          if (!track || !thumb || !bubble || !hiddenInput) return;

          function setValue(value) {
            value = Math.max(MIN, Math.min(MAX, Math.round(value)));
            const percent = ((value - MIN) / (MAX - MIN)) * 100;
            thumb.style.left = percent + '%';
            bubble.style.left = percent + '%';
            bubble.textContent = value;
            hiddenInput.value = value;
            const sliderInputEvent = new Event('input', { bubbles: true, cancelable: true });
            hiddenInput.dispatchEvent(sliderInputEvent);
            // formEngine automatycznie obs≈Çu≈ºy event input (updateFieldState ‚Üí recompute)

            ticks.forEach(tick =>
              tick.classList.toggle('active', parseInt(tick.dataset.value) === value)
            );
          }

          function getValueFromPosition(clientX) {
            const rect = track.getBoundingClientRect();
            const percent = Math.max(0, Math.min(100, ((clientX - rect.left) / rect.width) * 100));
            return Math.round((percent / 100) * (MAX - MIN) + MIN);
          }

          let isDragging = false;
          thumb.addEventListener('mousedown', e => {
            isDragging = true;
            e.preventDefault();
          });
          document.addEventListener(
            'mousemove',
            e => isDragging && setValue(getValueFromPosition(e.clientX))
          );
          document.addEventListener('mouseup', () => (isDragging = false));
          track.addEventListener(
            'click',
            e => e.target !== thumb && setValue(getValueFromPosition(e.clientX))
          );
          ticks.forEach(tick =>
            tick.addEventListener('click', () => setValue(parseInt(tick.dataset.value)))
          );
          thumb.addEventListener('touchstart', e => {
            isDragging = true;
            e.preventDefault();
          });
          document.addEventListener(
            'touchmove',
            e => isDragging && setValue(getValueFromPosition(e.touches[0].clientX))
          );
          document.addEventListener('touchend', () => (isDragging = false));
          setValue(DEFAULT);
        });
      })();
    </script>

    <!-- Custom Wall Size Slider JavaScript -->
    <script>
      (function () {
        const MIN = 20,
          MAX = 80,
          STEP = 5,
          DEFAULT = 50;

        document.addEventListener('DOMContentLoaded', function () {
          const track = document.getElementById('customWallSizeTrack');
          const thumb = document.getElementById('customWallSizeThumb');
          const bubble = document.getElementById('customWallSizeBubble');
          const hiddenInput = document.getElementById('wall_size');
          const container = track ? track.closest('.custom-slider-container') : null;
          const ticks = container ? container.querySelectorAll('.custom-slider-ticks .tick') : [];

          if (!track || !thumb || !bubble || !hiddenInput) return;

          function setValue(value) {
            value = Math.max(MIN, Math.min(MAX, Math.round(value / STEP) * STEP));
            const percent = ((value - MIN) / (MAX - MIN)) * 100;
            thumb.style.left = percent + '%';
            bubble.style.left = percent + '%';
            bubble.textContent = value;
            hiddenInput.value = value;
            const sliderInputEvent = new Event('input', { bubbles: true, cancelable: true });
            hiddenInput.dispatchEvent(sliderInputEvent);
            // formEngine automatycznie obs≈Çu≈ºy event input (updateFieldState ‚Üí recompute)

            ticks.forEach(tick =>
              tick.classList.toggle('active', parseInt(tick.dataset.value) === value)
            );
          }

          function getValueFromPosition(clientX) {
            const rect = track.getBoundingClientRect();
            const percent = Math.max(0, Math.min(100, ((clientX - rect.left) / rect.width) * 100));
            return Math.round((percent / 100) * (MAX - MIN) + MIN);
          }

          let isDragging = false;
          thumb.addEventListener('mousedown', e => {
            isDragging = true;
            e.preventDefault();
          });
          document.addEventListener(
            'mousemove',
            e => isDragging && setValue(getValueFromPosition(e.clientX))
          );
          document.addEventListener('mouseup', () => (isDragging = false));
          track.addEventListener(
            'click',
            e => e.target !== thumb && setValue(getValueFromPosition(e.clientX))
          );
          ticks.forEach(tick =>
            tick.addEventListener('click', () => setValue(parseInt(tick.dataset.value)))
          );
          thumb.addEventListener('touchstart', e => {
            isDragging = true;
            e.preventDefault();
          });
          document.addEventListener(
            'touchmove',
            e => isDragging && setValue(getValueFromPosition(e.touches[0].clientX))
          );
          document.addEventListener('touchend', () => (isDragging = false));
          setValue(DEFAULT);
        });
      })();
    </script>

    <!-- Quantity Input JavaScript -->
    <script>
      (function () {
        function initQuantityInputs() {
          const quantityInputs = document.querySelectorAll('.quantity-input');

          quantityInputs.forEach(fieldset => {
            const input = fieldset.querySelector('input[type="number"]');
            const subBtn = fieldset.querySelector('.quantity-btn--sub');
            const addBtn = fieldset.querySelector('.quantity-btn--add');

            if (!input || !subBtn || !addBtn) return;

            const step = parseFloat(input.getAttribute('step')) || 0.5;
            const min = parseFloat(input.getAttribute('min')) || 0;
            const max = parseFloat(input.getAttribute('max')) || Infinity;

            function updateButtons() {
              const value = parseFloat(input.value) || 0;
              subBtn.disabled = value <= min;
              addBtn.disabled = value >= max;
            }

            function changeValue(delta) {
              const currentValue = parseFloat(input.value) || 0;
              const newValue = Math.max(min, Math.min(max, currentValue + delta));

              input.value = newValue;

              // Wywo≈Çaj event change dla progressive disclosure
              const changeEvent = new Event('change', { bubbles: true, cancelable: true });
              input.dispatchEvent(changeEvent);

              const inputEvent = new Event('input', { bubbles: true, cancelable: true });
              input.dispatchEvent(inputEvent);

              updateButtons();
            }

            subBtn.addEventListener('click', () => changeValue(-step));
            addBtn.addEventListener('click', () => changeValue(step));

            input.addEventListener('input', updateButtons);
            input.addEventListener('change', updateButtons);

            updateButtons();
          });
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initQuantityInputs);
        } else {
          initQuantityInputs();
        }

        window.addEventListener('load', () => {
          setTimeout(initQuantityInputs, 100);
        });
      })();
    </script>

    <!-- Slider Confirm Buttons JavaScript -->
    <script>
      (function () {
        function initSliderConfirmButtons() {
          console.log('[Slider Confirm] Inicjalizacja przycisk√≥w potwierdzenia...');
          const containers = document.querySelectorAll('.custom-slider-container');
          console.log('[Slider Confirm] Znaleziono kontener√≥w:', containers.length);
          containers.forEach(container => {
            if (container.dataset.sliderConfirmInit === 'true') {
              console.log('[Slider Confirm] Kontener ju≈º zainicjalizowany, pomijam');
              return;
            }
            const hiddenInput = container.querySelector('input[type="hidden"][id]');
            const button = container.querySelector('.slider-confirm-card');
            if (!hiddenInput || !button) {
              console.warn('[Slider Confirm] Brak hiddenInput lub button w kontenerze:', {
                hiddenInput: !!hiddenInput,
                button: !!button,
              });
              return;
            }
            console.log('[Slider Confirm] Inicjalizujƒô przycisk dla:', hiddenInput.id);

            container.dataset.sliderConfirmInit = 'true';
            hiddenInput.dataset.requiresConfirm = hiddenInput.dataset.requiresConfirm || 'true';
            hiddenInput.dataset.sliderConfirmed = hiddenInput.dataset.sliderConfirmed || 'false';

            const targetId = button.dataset.sliderTarget || hiddenInput.id;
            if (targetId && targetId !== hiddenInput.id) {
              console.warn(
                `Przycisk potwierdzenia slidera wskazuje ${targetId}, ale znaleziono ${hiddenInput.id}`
              );
            }

            const syncState = () => {
              const isConfirmed = hiddenInput.dataset.sliderConfirmed === 'true';

              // Przycisk zawsze enabled
              button.disabled = false;

              button.setAttribute('aria-pressed', isConfirmed ? 'true' : 'false');
              container.classList.toggle('slider-confirmed', isConfirmed);
              button.classList.toggle('slider-confirm-card--confirmed', isConfirmed);
            };

            button.addEventListener('click', () => {
              console.log(
                '[Slider Confirm] Klikniƒôto przycisk potwierdzenia dla:',
                hiddenInput.id,
                'warto≈õƒá:',
                hiddenInput.value
              );

              // Zaznacz slider jako potwierdzony
              hiddenInput.dataset.sliderConfirmed = 'true';
              hiddenInput.dataset.lastConfirmedValue = hiddenInput.value;
              syncState();

              // BEZPO≈öREDNIE ODBLOKOWANIE P√ìL - bez refresh, bez recompute, bez dotykania innych warto≈õci
              const fieldId = hiddenInput.id;

              // Mapowanie: kt√≥ry slider odblokowuje kt√≥re pola
              const unlockMap = {
                number_balcony_doors: [
                  'building_floors',
                  'building_roof',
                  'building_heated_floors[]',
                  'attic_access',
                  'floor_height',
                  'garage_type',
                ],
                wall_size: [
                  'has_secondary_wall_material',
                  'has_external_isolation',
                  'internal_wall_isolation[material]',
                ],
                internal_wall_isolation_size: [
                  'has_secondary_wall_material',
                  'has_external_isolation',
                ],
                number_windows: ['number_huge_windows'],
                number_huge_windows: ['doors_type'],
                top_isolation_size: ['bottom_isolation'],
                indoor_temperature: ['ventilation_type'],
                hot_water_persons: ['hot_water_usage'],
              };

              const fieldsToUnlock = unlockMap[fieldId] || [];

              fieldsToUnlock.forEach(fieldName => {
                // Znajd≈∫ elementy pola (obs≈Çuga nazw z [] jak building_heated_floors[])
                let elements;
                try {
                  // Dla p√≥l z [] w nazwie u≈ºywaj tylko [name="..."]
                  if (fieldName.includes('[')) {
                    elements = document.querySelectorAll(`[name="${fieldName}"]`);
                  } else {
                    elements = document.querySelectorAll(`[name="${fieldName}"], #${fieldName}`);
                  }
                } catch (e) {
                  console.warn('[Slider Confirm] B≈ÇƒÖd selektora dla:', fieldName, e);
                  elements = [];
                }

                elements.forEach(el => {
                  // Usu≈Ñ klasƒô disabled
                  el.classList.remove('field-disabled');

                  // Odblokuj kontener
                  const container =
                    el.closest('.form-field-item') ||
                    el.closest('.form-field__radio-group') ||
                    el.closest('.option-cards') ||
                    el.closest('.form-field');
                  if (container) {
                    container.classList.remove('field-disabled');
                  }
                });

                // Odblokuj karty Tak/Nie je≈õli sƒÖ
                const yesNoCards = document.querySelectorAll(
                  `.yes-no-card[data-field="${fieldName}"]`
                );
                yesNoCards.forEach(card => {
                  card.classList.remove('yes-no-card--disabled');
                });
              });

              // NIE wywo≈Çuj updateSectionButtons() - mo≈ºe resetowaƒá warto≈õci przez cache
              // Przyciski sekcji bƒôdƒÖ zaktualizowane przy nastƒôpnej zmianie pola

              console.log('[Slider Confirm] Odblokowano pola:', fieldsToUnlock);
            });

            hiddenInput.addEventListener('input', () => {
              console.log(
                '[Slider Confirm] Event input otrzymany dla:',
                hiddenInput.id,
                'warto≈õƒá:',
                hiddenInput.value
              );
              // NIE resetuj potwierdzenia - po pierwszym potwierdzeniu pole pozostaje odblokowane
              // Aktualizuj tylko lastConfirmedValue dla informacji
              hiddenInput.dataset.lastConfirmedValue = hiddenInput.value;
              // Je≈õli slider by≈Ç ju≈º potwierdzony, upewnij siƒô ≈ºe pozostaje potwierdzony
              if (hiddenInput.dataset.sliderConfirmed === 'true') {
                // Pozostaw potwierdzony - nie resetuj
                syncState();
              }
              // formEngine automatycznie zareaguje na event input
            });

            const observer = new MutationObserver(() => {
              syncState();
            });
            observer.observe(hiddenInput, { attributes: true, attributeFilter: ['value'] });

            // Obserwuj zmiany widoczno≈õci kontenera
            const containerObserver = new MutationObserver(() => {
              syncState();
            });
            containerObserver.observe(container, {
              attributes: true,
              attributeFilter: ['style', 'class'],
            });

            syncState();
          });
        }

        // Funkcja pomocnicza dla zewnƒôtrznych wywo≈Ça≈Ñ (zachowana dla kompatybilno≈õci)
        window.handleSliderConfirm = function (fieldName) {
          const hiddenInput = document.getElementById(fieldName);
          if (!hiddenInput) return;

          // formEngine automatycznie zareaguje na te eventy
          const changeEvent = new Event('change', { bubbles: true, cancelable: true });
          hiddenInput.dispatchEvent(changeEvent);

          const inputEvent = new Event('input', { bubbles: true, cancelable: true });
          hiddenInput.dispatchEvent(inputEvent);
        };

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initSliderConfirmButtons);
        } else {
          initSliderConfirmButtons();
        }

        window.addEventListener('load', () => {
          setTimeout(initSliderConfirmButtons, 100);
        });
      })();
    </script>

    <!-- Force visibility of balcony fields -->
    <script>
      (function () {
        function forceBalconyVisibility() {
          // Wymu≈õ widoczno≈õƒá pola balkon√≥w
          const balconyFieldItem = document
            .querySelector('#has_balcony')
            ?.closest('.form-field-item');
          if (balconyFieldItem) {
            balconyFieldItem.style.display = 'block';
            balconyFieldItem.classList.remove('hidden');
            console.log('[forceVisibility] Wymuszono widoczno≈õƒá pola balkon√≥w');
          }

          // Wymu≈õ widoczno≈õƒá kontenera balconyFields (slider) - tylko je≈õli has_balcony === 'yes'
          // To jest OK, ≈ºe jest ukryty na poczƒÖtku
        }

        // Wykonaj natychmiast
        forceBalconyVisibility();

        // Wykonaj po za≈Çadowaniu DOM
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', forceBalconyVisibility);
        }

        // Wykonaj po za≈Çadowaniu wszystkich skrypt√≥w
        window.addEventListener('load', function () {
          setTimeout(forceBalconyVisibility, 100);
        });

        // Wykonaj po inicjalizacji formEngine
        const checkFormEngine = setInterval(function () {
          if (window.formEngine && window.formEngine.init) {
            setTimeout(forceBalconyVisibility, 200);
            clearInterval(checkFormEngine);
          }
        }, 100);

        // Zatrzymaj sprawdzanie po 5 sekundach
        setTimeout(function () {
          clearInterval(checkFormEngine);
        }, 5000);
      })();
    </script>

    <!-- UPROSZCZONY TRYB IZOLACJI - prze≈ÇƒÖczanie tryb√≥w dla single_house -->
    <script>
      (function () {
        'use strict';

        function setupSimplifiedInsulationMode() {
          const checkbox = document.getElementById('detailed_insulation_mode');
          if (!checkbox) return;

          // Funkcja do aktualizacji widoczno≈õci kontener√≥w
          function updateInsulationModeVisibility() {
            if (window.formEngine && window.formEngine.softRefresh) {
              setTimeout(() => {
                window.formEngine.softRefresh();
              }, 50);
            }
          }

          // Listener na zmianƒô checkboxa
          checkbox.addEventListener('change', function () {
            const isDetailed = checkbox.checked;
            // Ustaw warto≈õƒá jako 'yes'/'no' (zgodnie z tym jak formEngine odczytuje checkboxy)
            const value = isDetailed ? 'yes' : 'no';

            // Aktualizuj stan w formEngine
            if (window.formEngine && window.formEngine.state && window.formEngine.state.setValue) {
              window.formEngine.state.setValue('detailed_insulation_mode', value);
              // Wymu≈õ aktualizacjƒô pola (aby formEngine odczyta≈Ç warto≈õƒá z checkboxa)
              if (window.formEngine.refreshField) {
                window.formEngine.refreshField('detailed_insulation_mode');
              }
              updateInsulationModeVisibility();
            }
          });

          // Listener na zmianƒô building_type (dla automatycznej aktualizacji)
          const buildingTypeInput = document.getElementById('building_type');
          if (buildingTypeInput) {
            buildingTypeInput.addEventListener('change', function () {
              const buildingType = this.value;
              if (buildingType === 'single_house') {
                // Dla single_house: ustaw domy≈õlnie tryb uproszczony
                checkbox.checked = false;
                if (
                  window.formEngine &&
                  window.formEngine.state &&
                  window.formEngine.state.setValue
                ) {
                  window.formEngine.state.setValue('detailed_insulation_mode', 'no');
                  if (window.formEngine.refreshField) {
                    window.formEngine.refreshField('detailed_insulation_mode');
                  }
                  updateInsulationModeVisibility();
                }
              } else {
                // Dla innych typ√≥w: ustaw tryb szczeg√≥≈Çowy (checkbox nie ma znaczenia, ale ustawiamy dla sp√≥jno≈õci)
                checkbox.checked = false;
                if (
                  window.formEngine &&
                  window.formEngine.state &&
                  window.formEngine.state.setValue
                ) {
                  window.formEngine.state.setValue('detailed_insulation_mode', 'no');
                  if (window.formEngine.refreshField) {
                    window.formEngine.refreshField('detailed_insulation_mode');
                  }
                  updateInsulationModeVisibility();
                }
              }
            });
          }

          // Listener na custom event building_type_change
          document.addEventListener('building_type_change', function (e) {
            const buildingType = e.detail?.value;
            if (buildingType === 'single_house') {
              checkbox.checked = false;
              if (
                window.formEngine &&
                window.formEngine.state &&
                window.formEngine.state.setValue
              ) {
                window.formEngine.state.setValue('detailed_insulation_mode', 'no');
                if (window.formEngine.refreshField) {
                  window.formEngine.refreshField('detailed_insulation_mode');
                }
                updateInsulationModeVisibility();
              }
            } else {
              checkbox.checked = false;
              if (
                window.formEngine &&
                window.formEngine.state &&
                window.formEngine.state.setValue
              ) {
                window.formEngine.state.setValue('detailed_insulation_mode', 'no');
                if (window.formEngine.refreshField) {
                  window.formEngine.refreshField('detailed_insulation_mode');
                }
                updateInsulationModeVisibility();
              }
            }
          });

          // Inicjalizacja przy za≈Çadowaniu - sprawd≈∫ czy single_house
          function initializeMode() {
            if (window.formEngine && window.formEngine.getState) {
              const state = window.formEngine.getState();
              if (state && state.building_type === 'single_house') {
                // Ustaw domy≈õlnie tryb uproszczony (checkbox nie zaznaczony)
                checkbox.checked = false;
                if (window.formEngine.state && window.formEngine.state.setValue) {
                  // Ustaw jako 'no' (zgodnie z tym jak formEngine odczytuje checkboxy)
                  window.formEngine.state.setValue('detailed_insulation_mode', 'no');
                  // Wymu≈õ aktualizacjƒô pola
                  if (window.formEngine.refreshField) {
                    window.formEngine.refreshField('detailed_insulation_mode');
                  }
                  updateInsulationModeVisibility();
                }
              }
            }
          }

          // Wywo≈Çaj inicjalizacjƒô po kr√≥tkim op√≥≈∫nieniu (gdy formEngine jest gotowy)
          setTimeout(initializeMode, 200);

          // Dodatkowo: nas≈Çuchuj na zmiany w formEngine (gdy building_type siƒô zmienia)
          if (window.formEngine && window.formEngine.state) {
            // Sprawd≈∫ stan co 500ms przez pierwsze 5 sekund (dla przypadk√≥w gdy building_type jest ustawiane p√≥≈∫niej)
            let checkCount = 0;
            const maxChecks = 10;
            const checkInterval = setInterval(() => {
              checkCount++;
              if (checkCount > maxChecks) {
                clearInterval(checkInterval);
                return;
              }
              const state = window.formEngine.getState();
              if (state && state.building_type === 'single_house') {
                // Sprawd≈∫ czy detailed_insulation_mode jest ustawione
                if (
                  state.detailed_insulation_mode === undefined ||
                  state.detailed_insulation_mode === null ||
                  state.detailed_insulation_mode === ''
                ) {
                  checkbox.checked = false;
                  if (window.formEngine.state && window.formEngine.state.setValue) {
                    window.formEngine.state.setValue('detailed_insulation_mode', 'no');
                    if (window.formEngine.refreshField) {
                      window.formEngine.refreshField('detailed_insulation_mode');
                    }
                    updateInsulationModeVisibility();
                  }
                }
              }
            }, 500);
          }

          // Funkcja testowa do konsoli (do debugowania)
          window.testInsulationMode = function () {
            const state = window.formEngine ? window.formEngine.getState() : {};
            const container = document.getElementById('simplifiedInsulationMode');
            const detailedContainer = document.getElementById('detailedInsulationMode');
            console.log('=== TEST INSULATION MODE ===');
            console.log('State:', {
              building_type: state.building_type,
              detailed_insulation_mode: state.detailed_insulation_mode,
              type: typeof state.detailed_insulation_mode,
            });
            console.log('Containers:', {
              simplified: {
                exists: !!container,
                hasHidden: container ? container.classList.contains('hidden') : false,
                computedDisplay: container ? window.getComputedStyle(container).display : 'N/A',
                inlineDisplay: container ? container.style.display : 'N/A',
              },
              detailed: {
                exists: !!detailedContainer,
                hasHidden: detailedContainer
                  ? detailedContainer.classList.contains('hidden')
                  : false,
                computedDisplay: detailedContainer
                  ? window.getComputedStyle(detailedContainer).display
                  : 'N/A',
                inlineDisplay: detailedContainer ? detailedContainer.style.display : 'N/A',
              },
            });
            console.log('Checkbox:', {
              exists: !!checkbox,
              checked: checkbox ? checkbox.checked : false,
              value: checkbox ? checkbox.value : 'N/A',
            });
            return { state, container, detailedContainer, checkbox };
          };
        }

        // Inicjalizuj po za≈Çadowaniu DOM i formEngine
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', function () {
            // Poczekaj na formEngine
            const checkEngine = setInterval(function () {
              if (window.formEngine && window.formEngine.state) {
                setupSimplifiedInsulationMode();
                clearInterval(checkEngine);
              }
            }, 100);

            setTimeout(() => clearInterval(checkEngine), 5000);
          });
        } else {
          // DOM ju≈º za≈Çadowany
          const checkEngine = setInterval(function () {
            if (window.formEngine && window.formEngine.state) {
              setupSimplifiedInsulationMode();
              clearInterval(checkEngine);
            }
          }, 100);

          setTimeout(() => clearInterval(checkEngine), 5000);
        }
      })();
    </script>

    <!-- Progress Steps Updater JavaScript -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Funkcja do aktualizacji progress steps na podstawie aktywnej sekcji
        function updateProgressSteps() {
          const activeSection = document.querySelector('.section.active');
          if (!activeSection) return;

          const currentTab = parseInt(activeSection.getAttribute('data-tab')) || 0;
          const allSteps = document.querySelectorAll('.progress-step');

          allSteps.forEach((step, index) => {
            const stepNumber = index + 1;

            // Usu≈Ñ wszystkie klasy
            step.classList.remove('active', 'completed');

            if (stepNumber < currentTab + 1) {
              // Uko≈Ñczone kroki
              step.classList.add('completed');
              step.textContent = ''; // Checkmark bƒôdzie z CSS ::after
            } else if (stepNumber === currentTab + 1) {
              // Aktywny krok
              step.classList.add('active');
              step.textContent = stepNumber;
            } else {
              // Przysz≈Çe kroki
              step.textContent = stepNumber;
            }
          });
        }

        // Aktualizuj na starcie
        updateProgressSteps();

        // Obserwuj zmiany w klasie 'active' na sekcjach
        const sections = document.querySelectorAll('.section');
        const sectionObserver = new MutationObserver(updateProgressSteps);

        sections.forEach(section => {
          sectionObserver.observe(section, {
            attributes: true,
            attributeFilter: ['class'],
          });
        });
      });
    </script>

    <!-- Funkcjonalno≈õƒá akordeon√≥w dla wszystkich sekcji wynik√≥w -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Akordeon dla profilu energetycznego
        const energyProfileSections = document.querySelectorAll('.energy-profile-section');
        energyProfileSections.forEach(section => {
          const title = section.querySelector('.result-title');
          if (title) {
            title.addEventListener('click', function () {
              section.classList.toggle('collapsed');
              const content = section.querySelector('.result-grid');
              const subtitle = section.querySelector('.result-subtitle');
              const dataComment = section.nextElementSibling; // .data-comment jest zaraz po sekcji

              if (section.classList.contains('collapsed')) {
                if (content) content.style.display = 'none';
                if (subtitle) subtitle.style.display = 'none';
                if (dataComment && dataComment.classList.contains('data-comment')) {
                  dataComment.style.display = 'none';
                }
              } else {
                if (content) content.style.display = 'table';
                if (subtitle) subtitle.style.display = 'block';
                if (dataComment && dataComment.classList.contains('data-comment')) {
                  dataComment.style.display = 'block';
                }
              }
            });
          }
        });

        // Akordeon dla extended-section
        const extendedSections = document.querySelectorAll('.extended-section.accordion-section');
        extendedSections.forEach(section => {
          const title = section.querySelector('.section-title');
          if (title) {
            title.addEventListener('click', function () {
              section.classList.toggle('collapsed');
            });
          }
        });

        // Akordeon dla sekcji rekomendacji pomp
        const pumpRecommendationSection = document.querySelector(
          '.pump-recommendation-section.accordion-section'
        );
        if (pumpRecommendationSection) {
          const header = pumpRecommendationSection.querySelector('.slider-header h3');
          if (header) {
            header.addEventListener('click', function () {
              pumpRecommendationSection.classList.toggle('collapsed');
            });
          }
        }

        // Akordeon dla haier-slider-wrapper
        const pumpSections = document.querySelectorAll('.haier-slider-wrapper.accordion-section');
        pumpSections.forEach(section => {
          const header = section.querySelector('.slider-header h3');
          if (header) {
            header.addEventListener('click', function () {
              section.classList.toggle('collapsed');
            });
          }
        });
      });
    </script>

    <!-- Szybka symulacja z gotowymi danymi (Quick Scenario dla zak≈Çadki 0) -->
    <div id="quick-scenario-modal" class="quick-scenario-modal" aria-hidden="true">
      <div class="quick-scenario-backdrop"></div>
      <div
        class="quick-scenario-dialog"
        role="dialog"
        aria-modal="true"
        aria-labelledby="quick-scenario-title"
      >
        <h3 id="quick-scenario-title">Szybka symulacja na przyk≈Çadowych danych</h3>
        <p class="quick-scenario-subtitle">
          Te warto≈õci symulujƒÖ w pe≈Çni wype≈Çniony formularz. Mo≈ºesz je szybko skorygowaƒá przyciskami
          ‚Äû‚àí / +‚Äù, a nastƒôpnie uruchomiƒá obliczenia bez przechodzenia wszystkich krok√≥w.
        </p>
        <div id="quick-scenario-fields" class="quick-scenario-fields"></div>
        <div class="quick-scenario-actions">
          <button type="button" class="quick-scenario-cancel">Anuluj</button>
          <button type="button" class="quick-scenario-ok">OK ‚Äì oblicz</button>
        </div>
      </div>
    </div>

    <script>
      (function () {
        const defaultPayload = {
          building_type: 'single_house',
          construction_year: 2000,
          construction_type: 'traditional',
          latitude: 51.1079,
          longitude: 17.0385,
          building_length: 10,
          building_width: 5,
          building_floors: 1,
          building_heated_floors: [1, 2],
          floor_height: 2.6,
          building_roof: 'steep',
          has_basement: false,
          has_balcony: true,
          wall_size: 50,
          primary_wall_material: 84,
          top_isolation: { material: 68, size: 30 },
          bottom_isolation: { material: 71, size: 5 },
          number_doors: 1,
          number_balcony_doors: 1,
          number_windows: 14,
          number_huge_windows: 0,
          doors_type: 'new_wooden',
          windows_type: '2021_triple_glass',
          indoor_temperature: 21,
          ventilation_type: 'natural',
          heating_type: 'underfloor',
          source_type: 'air_to_water_hp',
          include_hot_water: true,
          hot_water_persons: 4,
          hot_water_usage: 'shower_bath',
        };

        const fieldConfigs = [
          { key: 'building_length', label: 'D≈Çugo≈õƒá budynku [m]', step: 0.5, min: 4, max: 40 },
          { key: 'building_width', label: 'Szeroko≈õƒá budynku [m]', step: 0.5, min: 3, max: 30 },
          { key: 'building_floors', label: 'Liczba kondygnacji', step: 1, min: 1, max: 4 },
          { key: 'floor_height', label: 'Wysoko≈õƒá kondygnacji [m]', step: 0.1, min: 2.2, max: 4.0 },
          { key: 'wall_size', label: 'Grubo≈õƒá ≈õcian [cm]', step: 1, min: 20, max: 80 },
          { key: 'number_windows', label: 'Liczba okien', step: 1, min: 0, max: 40 },
          {
            key: 'indoor_temperature',
            label: 'Temperatura wewnƒôtrzna [¬∞C]',
            step: 1,
            min: 18,
            max: 24,
          },
          { key: 'hot_water_persons', label: 'Liczba os√≥b (CWU)', step: 1, min: 1, max: 10 },
          { key: 'top_isolation.size', label: 'Izolacja stropu [cm]', step: 1, min: 0, max: 40 },
          {
            key: 'bottom_isolation.size',
            label: 'Izolacja pod≈Çogi [cm]',
            step: 1,
            min: 0,
            max: 30,
          },
        ];

        function getByPath(obj, path) {
          return path
            .split('.')
            .reduce((acc, key) => (acc && typeof acc === 'object' ? acc[key] : undefined), obj);
        }

        function setByPath(obj, path, value) {
          const parts = path.split('.');
          const last = parts.pop();
          let current = obj;
          parts.forEach(key => {
            if (!current[key] || typeof current[key] !== 'object') current[key] = {};
            current = current[key];
          });
          current[last] = value;
        }

        function openQuickScenarioModal() {
          const modal = document.getElementById('quick-scenario-modal');
          const fieldsContainer = document.getElementById('quick-scenario-fields');
          if (!modal || !fieldsContainer) return;

          const workingPayload = JSON.parse(JSON.stringify(defaultPayload));
          modal.__payload = workingPayload;

          fieldsContainer.innerHTML = '';

          fieldConfigs.forEach(cfg => {
            const value = getByPath(workingPayload, cfg.key);
            const row = document.createElement('div');
            row.className = 'quick-scenario-row';
            row.dataset.key = cfg.key;

            row.innerHTML = `
              <div class="quick-scenario-label">${cfg.label}</div>
              <div class="quick-scenario-controls">
                <button type="button" class="qs-btn qs-minus" aria-label="Zmniejsz warto≈õƒá">‚àí</button>
                <input type="number" class="qs-input" value="${value}" step="${cfg.step}" ${
              cfg.min !== undefined ? `min="${cfg.min}"` : ''
            } ${cfg.max !== undefined ? `max="${cfg.max}"` : ''}>
                <button type="button" class="qs-btn qs-plus" aria-label="Zwiƒôksz warto≈õƒá">+</button>
              </div>
            `;

            const input = row.querySelector('.qs-input');
            const minus = row.querySelector('.qs-minus');
            const plus = row.querySelector('.qs-plus');

            function clamp(val) {
              let num = parseFloat(val);
              if (isNaN(num)) num = cfg.min !== undefined ? cfg.min : 0;
              if (cfg.min !== undefined && num < cfg.min) num = cfg.min;
              if (cfg.max !== undefined && num > cfg.max) num = cfg.max;
              return num;
            }

            minus?.addEventListener('click', function () {
              const current = clamp(input.value === '' ? cfg.min : input.value);
              input.value = clamp(current - (cfg.step || 1));
            });

            plus?.addEventListener('click', function () {
              const current = clamp(input.value === '' ? cfg.min : input.value);
              input.value = clamp(current + (cfg.step || 1));
            });

            input.addEventListener('change', function () {
              input.value = clamp(input.value);
            });

            fieldsContainer.appendChild(row);
          });

          modal.classList.add('is-open');
          modal.setAttribute('aria-hidden', 'false');
        }

        function closeQuickScenarioModal() {
          const modal = document.getElementById('quick-scenario-modal');
          if (!modal) return;
          modal.classList.remove('is-open');
          modal.setAttribute('aria-hidden', 'true');
        }

        async function sendQuickScenario() {
          const modal = document.getElementById('quick-scenario-modal');
          const fieldsContainer = document.getElementById('quick-scenario-fields');
          if (!modal || !fieldsContainer || !modal.__payload) return;

          const payload = modal.__payload;
          const rows = fieldsContainer.querySelectorAll('.quick-scenario-row');
          rows.forEach(row => {
            const key = row.dataset.key;
            const input = row.querySelector('.qs-input');
            if (!key || !input) return;
            const cfg = fieldConfigs.find(f => f.key === key);
            const raw = input.value;
            let num = raw === '' ? null : parseFloat(raw);
            if (num !== null && !isNaN(num)) {
              if (cfg) {
                if (cfg.min !== undefined && num < cfg.min) num = cfg.min;
                if (cfg.max !== undefined && num > cfg.max) num = cfg.max;
              }
              setByPath(payload, key, num);
            }
          });

          closeQuickScenarioModal();

          // U≈ºyj naszego silnika OZC (jak w callCieplo)
          const USE_OZC_ENGINE_PRIMARY = true;

          try {
            let resultData;
            let data;

            if (
              USE_OZC_ENGINE_PRIMARY &&
              window.OZCEngine &&
              typeof window.OZCEngine.calculate === 'function'
            ) {
              // U≈ºyj lokalnego silnika OZC
              console.log('üîß [Quick Scenario] U≈ºywam lokalnego silnika OZC...');

              try {
                const ozcResult = await window.OZCEngine.calculate(payload);
                const cieploFormat = window.OZCEngine.convertToCieploAppFormat(ozcResult, payload);

                data = {
                  id: cieploFormat.id,
                  result: cieploFormat,
                  source: 'internal_ozc_engine',
                  fallback: false,
                };

                resultData = cieploFormat;
                console.log('‚úÖ [Quick Scenario] Obliczenia OZC zako≈Ñczone:', ozcResult);
              } catch (ozcError) {
                console.error('‚ùå [Quick Scenario] B≈ÇƒÖd silnika OZC:', ozcError);
                ErrorHandler.showToast('B≈ÇƒÖd oblicze≈Ñ OZC: ' + ozcError.message, 'error');
                return;
              }
            } else {
              // Fallback do API (je≈õli silnik nie jest dostƒôpny)
              const proxyUrl = 'https://topinstal.com.pl/cieplo-proxy.php';
              const response = await fetch(proxyUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
              });

              try {
                data = await response.json();
              } catch (err) {
                ErrorHandler.showToast('Nie uda≈Ço siƒô odczytaƒá odpowiedzi z serwera', 'error');
                return;
              }

              if (data.errors && Object.keys(data.errors).length > 0) {
                ErrorHandler.handleAPIErrors(data.errors);
                return;
              }

              resultData = data.result || (data.max_heating_power && data.total_area ? data : null);
              if (!resultData) {
                ErrorHandler.showToast('Serwer nie zwr√≥ci≈Ç wyniku oblicze≈Ñ', 'error', 5000);
                return;
              }
            }

            // Zapisz wynik
            window.lastCalculationResult = resultData;

            // Przejd≈∫ do zak≈Çadki wynik√≥w (PO otrzymaniu danych)
            if (typeof window.showTab === 'function') {
              window.showTab(6);
              console.log('‚úÖ [Quick Scenario] Przej≈õcie do zak≈Çadki wynik√≥w (tab 6)');
            }

            // Upewnij siƒô ≈ºe konfigurator jest widoczny
            setTimeout(() => {
              const configuratorView = document.getElementById('configurator-view');
              const energyProfileView = document.getElementById('energy-profile-view');
              const configuratorBtn = document.querySelector('[data-target="configurator-view"]');

              if (configuratorView && energyProfileView) {
                // Poka≈º konfigurator, ukryj profil energetyczny
                configuratorView.classList.remove('hidden');
                configuratorView.classList.add('visible');
                energyProfileView.classList.remove('visible');
                energyProfileView.classList.add('hidden');

                // Aktywuj przycisk konfiguratora
                if (configuratorBtn) {
                  configuratorBtn.classList.add('active');
                  configuratorBtn.setAttribute('aria-pressed', 'true');
                  const energyBtn = document.querySelector('[data-target="energy-profile-view"]');
                  if (energyBtn) {
                    energyBtn.classList.remove('active');
                    energyBtn.setAttribute('aria-pressed', 'false');
                  }
                }

                console.log('‚úÖ [Quick Scenario] Konfigurator ustawiony jako widoczny');
              }
            }, 200);

            // Wy≈õwietl wyniki i zainicjalizuj konfigurator
            if (typeof window.displayResults === 'function') {
              // Op√≥≈∫nienie aby upewniƒá siƒô ≈ºe showTab i switcher siƒô wykona≈Çy
              setTimeout(() => {
                window.displayResults(window.lastCalculationResult || resultData);
                console.log('‚úÖ [Quick Scenario] Wy≈õwietlono wyniki i konfigurator');
              }, 300);
            } else {
              console.warn('‚ö†Ô∏è [Quick Scenario] window.displayResults nie jest dostƒôpna');
            }
          } catch (error) {
            console.error('‚ùå [Quick Scenario] B≈ÇƒÖd:', error);
            ErrorHandler.showToast(
              'Nie uda≈Ço siƒô wykonaƒá szybkiej symulacji: ' + error.message,
              'error'
            );
          }
        }

        function initQuickScenario() {
          const trigger = document.getElementById('quick-scenario-trigger');
          const modal = document.getElementById('quick-scenario-modal');
          if (!trigger || !modal) return;

          const okBtn = modal.querySelector('.quick-scenario-ok');
          const cancelBtn = modal.querySelector('.quick-scenario-cancel');
          const backdrop = modal.querySelector('.quick-scenario-backdrop');

          trigger.addEventListener('click', openQuickScenarioModal);
          okBtn?.addEventListener('click', sendQuickScenario);
          cancelBtn?.addEventListener('click', closeQuickScenarioModal);
          backdrop?.addEventListener('click', closeQuickScenarioModal);

          document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && modal.classList.contains('is-open')) {
              closeQuickScenarioModal();
            }
          });
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initQuickScenario);
        } else {
          initQuickScenario();
        }
      })();
    </script>

    <!-- DEBUG: SUPER-LOGGER building_type -->
    <script>
      // Globalny kontener na timeline
      window.__BT_DEBUG = window.__BT_DEBUG || { timeline: [] };

      function btPush(event) {
        window.__BT_DEBUG.timeline.push({
          ts: new Date().toISOString(),
          ...event,
          stack: (new Error().stack || '').split('\n').slice(2, 10),
        });
      }
    </script>

    <!-- DEBUG: Hook DOM ‚Äì ka≈ºde ustawienie value na #building_type -->
    <script>
      (function () {
        const desc = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value');
        if (!desc || !desc.set || !desc.get) {
          console.warn('[BT-DOM] Nie uda≈Ço siƒô przechwyciƒá HTMLInputElement.value');
          return;
        }

        Object.defineProperty(HTMLInputElement.prototype, 'value', {
          get: function () {
            return desc.get.call(this);
          },
          set: function (v) {
            if (this.id === 'building_type' || this.name === 'building_type') {
              btPush({
                type: 'dom-set',
                target: '#building_type',
                newValue: v,
                location: 'HTMLInputElement.value setter',
              });
              console.log(
                '%c[BT-DOM] value= na building_type',
                'color:#ef4444;font-weight:bold;',
                v
              );
            }
            return desc.set.call(this, v);
          },
        });
      })();
    </script>

    <!-- DEBUG: Hook formEngine.state.setValue dla building_type -->
    <script>
      (function () {
        if (!window.formEngine || !window.formEngine.state) {
          console.warn('[BT-STATE] formEngine.state nie jest dostƒôpny');
          return;
        }

        const state = window.formEngine.state;
        const origSetValue = state.setValue.bind(state);
        const origGetValue = state.getValue.bind(state);

        state.setValue = function (name, value) {
          const prev = origGetValue(name);
          const res = origSetValue(name, value);

          if (name === 'building_type') {
            btPush({
              type: 'state-set',
              field: 'building_type',
              prevValue: prev,
              newValue: value,
              location: 'formEngine.state.setValue',
            });

            console.log('%c[BT-STATE] setValue(building_type)', 'color:#f97316;font-weight:bold;', {
              prev,
              next: value,
            });
          }

          return res;
        };
      })();
    </script>

    <!-- DEBUG: Wrapper buildJsonData ‚Äì stan, DOM i payload -->
    <script>
      (function () {
        if (typeof window.buildJsonData !== 'function') {
          console.warn('[BT-DEBUG] buildJsonData nie jest dostƒôpne');
          return;
        }

        const origBuildJsonData = window.buildJsonData;

        window.buildJsonData = function () {
          const engineState =
            window.formEngine && typeof window.formEngine.getState === 'function'
              ? window.formEngine.getState()
              : {};

          const domInput = document.getElementById('building_type');
          const domValue = domInput ? domInput.value : undefined;

          const selectedCards = Array.from(
            document.querySelectorAll('.building-type-card.building-type-card--selected')
          ).map(c => c.dataset.value);

          btPush({
            type: 'buildJson:before',
            engine_building_type: engineState.building_type,
            dom_building_type: domValue,
            selectedCards,
            location: 'buildJsonData(before)',
          });

          console.log('%c[BT-DEBUG:PRZED] buildJsonData', 'color:#0ea5e9;font-weight:bold;', {
            engine_building_type: engineState.building_type,
            dom_building_type: domValue,
            selectedCards,
          });

          const data = origBuildJsonData();

          btPush({
            type: 'buildJson:after',
            payload_building_type: data.building_type,
            location: 'buildJsonData(after)',
          });

          console.log('%c[BT-DEBUG:PO] buildJsonData', 'color:#22c55e;font-weight:bold;', {
            result_building_type: data.building_type,
          });

          return data;
        };
      })();
    </script>

    <!-- DEBUG: helper do snapshotu + wydruk ca≈Çej historii -->
    <script>
      window.debugBuildingTypeSnapshot = function (label) {
        const engineState =
          window.formEngine && typeof window.formEngine.getState === 'function'
            ? window.formEngine.getState()
            : {};

        const payload = typeof window.buildJsonData === 'function' ? window.buildJsonData() : null;

        console.log('%c[BT-SNAPSHOT]', 'color:#a855f7;font-weight:bold;', label || '', {
          engine_building_type: engineState.building_type,
          payload_building_type: payload && payload.building_type,
          fullEngineState: engineState,
          payload,
        });
      };

      window.printBuildingTypeTimeline = function () {
        if (!window.__BT_DEBUG || !Array.isArray(window.__BT_DEBUG.timeline)) {
          console.log('Brak danych w __BT_DEBUG.timeline');
          return;
        }
        console.table(
          window.__BT_DEBUG.timeline.map((e, i) => ({
            i,
            ts: e.ts,
            type: e.type,
            prev: e.prevValue,
            next: e.newValue,
            engine_bt: e.engine_building_type,
            dom_bt: e.dom_building_type,
            payload_bt: e.payload_building_type,
            location: e.location,
          }))
        );
        console.log('__BT_DEBUG.timeline =', window.__BT_DEBUG.timeline);
      };
    </script>

    <!-- Results Switcher Logic -->
    <script>
      (function () {
        'use strict';

        function initResultsSwitcher() {
          const switcher = document.getElementById('results-switcher');
          if (!switcher) {
            console.warn('[ResultsSwitcher] Element #results-switcher nie znaleziony');
            return;
          }

          // Sprawd≈∫ czy jeste≈õmy w sekcji wynik√≥w (data-tab="6")
          const resultsSection = switcher.closest('.section[data-tab="6"]');
          if (!resultsSection) {
            console.warn('[ResultsSwitcher] Switcher nie jest w sekcji wynik√≥w');
            return;
          }

          // Sprawd≈∫ czy sekcja wynik√≥w jest aktywna
          if (!resultsSection.classList.contains('active')) {
            console.log(
              '[ResultsSwitcher] Sekcja wynik√≥w nie jest aktywna - pomijam inicjalizacjƒô'
            );
            return;
          }

          const buttons = switcher.querySelectorAll('.results-switch-btn');
          const views = document.querySelectorAll('.results-view');

          if (buttons.length === 0 || views.length === 0) {
            console.warn('[ResultsSwitcher] Brak przycisk√≥w lub widok√≥w');
            return;
          }

          // Sprawd≈∫ czy ju≈º zainicjalizowano
          if (switcher.dataset.initialized === 'true') {
            console.log('[ResultsSwitcher] Ju≈º zainicjalizowany - pomijam');
            return;
          }

          console.log('[ResultsSwitcher] Inicjalizacja:', buttons.length, 'przycisk√≥w');

          // Oznacz jako zainicjalizowany
          switcher.dataset.initialized = 'true';

          // Funkcja prze≈ÇƒÖczania widok√≥w
          function switchView(targetId) {
            console.log('[ResultsSwitcher] üîÑ Prze≈ÇƒÖczam na:', targetId);
            console.log('[ResultsSwitcher] üìç Liczba przycisk√≥w:', buttons.length);
            console.log('[ResultsSwitcher] üìç Liczba widok√≥w:', views.length);

            // NIE UKRYWAJ progress bara tutaj - switcher jest widoczny dopiero po klikniƒôciu
            // "Rozpocznij personalizacjƒô", wiƒôc progress bar ju≈º bƒôdzie ukryty przez startConfigurator()

            // Dezaktywuj wszystkie przyciski
            buttons.forEach(btn => {
              btn.classList.remove('active');
              btn.setAttribute('aria-pressed', 'false');
            });
            console.log('[ResultsSwitcher] ‚úÖ Dezaktywowano przyciski');

            // Ukryj wszystkie widoki
            views.forEach(view => {
              view.classList.remove('visible');
              view.classList.add('hidden');
            });
            console.log('[ResultsSwitcher] ‚úÖ Ukryto wszystkie widoki');

            // Aktywuj wybrany przycisk
            const activeButton = Array.from(buttons).find(btn => btn.dataset.target === targetId);
            if (activeButton) {
              activeButton.classList.add('active');
              activeButton.setAttribute('aria-pressed', 'true');
              console.log('[ResultsSwitcher] ‚úÖ Aktywowano przycisk:', targetId);
            } else {
              console.warn('[ResultsSwitcher] ‚ö†Ô∏è Nie znaleziono przycisku dla:', targetId);
            }

            // Poka≈º wybrany widok
            const targetView = document.getElementById(targetId);
            if (targetView) {
              targetView.classList.remove('hidden');
              targetView.classList.add('visible');
              console.log('[ResultsSwitcher] ‚úÖ Pokazano widok:', targetId);

              // BRAK scrollowania - u≈ºytkownik pozostaje w aktualnej pozycji
              // (prze≈ÇƒÖczanie widok√≥w odbywa siƒô w obrƒôbie tego samego kroku formularza)
            }

            // Zapisz wyb√≥r w sessionStorage (opcjonalnie)
            try {
              sessionStorage.setItem('topinstal_results_view', targetId);
            } catch (e) {
              console.warn('[ResultsSwitcher] Nie mo≈ºna zapisaƒá do sessionStorage:', e);
            }
          }

          // Obs≈Çuga klikniƒôƒá
          buttons.forEach(btn => {
            btn.addEventListener('click', function (e) {
              console.log('[ResultsSwitcher] üñ±Ô∏è Klikniƒôto przycisk:', this.dataset.target);

              e.preventDefault(); // Zapobiegaj submit formularza
              e.stopPropagation(); // Zapobiegaj propagacji eventu

              const target = this.dataset.target;
              if (target) {
                console.log('[ResultsSwitcher] üéØ Wywo≈Çujƒô switchView dla:', target);
                switchView(target);
              } else {
                console.warn('[ResultsSwitcher] ‚ö†Ô∏è Przycisk nie ma data-target');
              }
            });
          });

          // Przywr√≥ƒá ostatni wyb√≥r (opcjonalnie)
          try {
            const savedView = sessionStorage.getItem('topinstal_results_view');
            if (savedView && document.getElementById(savedView)) {
              switchView(savedView);
            }
          } catch (e) {
            console.warn('[ResultsSwitcher] Nie mo≈ºna odczytaƒá z sessionStorage:', e);
          }

          console.log('[ResultsSwitcher] ‚úÖ Zainicjalizowano pomy≈õlnie');
        }

        // NIE inicjalizuj automatycznie po za≈Çadowaniu DOM
        // Inicjalizuj TYLKO gdy u≈ºytkownik przejdzie do zak≈Çadki wynik√≥w

        // Czekaj a≈º showTab bƒôdzie dostƒôpny
        function wrapShowTab() {
          if (typeof window.showTab === 'function') {
            const originalShowTab = window.showTab;

            window.showTab = function (index) {
              console.log('[ResultsSwitcher] üìç showTab wywo≈Çany z index:', index);

              // Wywo≈Çaj oryginalnƒÖ funkcjƒô
              originalShowTab(index);

              // Je≈õli przeszli≈õmy do zak≈Çadki wynik√≥w (6), zainicjalizuj switcher
              if (index === 6) {
                setTimeout(() => {
                  console.log(
                    '[ResultsSwitcher] üéØ Wykryto przej≈õcie do zak≈Çadki 6 - inicjalizujƒô'
                  );
                  initResultsSwitcher();
                }, 300);
              }
            };

            console.log('[ResultsSwitcher] ‚úÖ Zainstalowano wrapper dla showTab');
          } else {
            console.warn('[ResultsSwitcher] ‚ö†Ô∏è window.showTab nie jest jeszcze dostƒôpny');
            setTimeout(wrapShowTab, 100);
          }
        }

        // Zainstaluj wrapper
        wrapShowTab();

        // Alternatywnie - nas≈Çuchuj na custom event
        document.addEventListener('tab-changed', function (e) {
          if (e.detail && e.detail.tab === 6) {
            setTimeout(initResultsSwitcher, 300);
          }
        });

        // Fallback - je≈õli sekcja wynik√≥w jest ju≈º aktywna przy ≈Çadowaniu
        window.addEventListener('load', function () {
          const resultsSection = document.querySelector('.section[data-tab="6"]');
          if (resultsSection && resultsSection.classList.contains('active')) {
            setTimeout(initResultsSwitcher, 500);
          }
        });
      })();
    </script>

    <!-- üÜï MOBILE CONTROLLER -->
    <script src="./js/mobileController.js"></script>
  </body>
</html>
